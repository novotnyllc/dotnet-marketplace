{
  "created_at": "2026-02-12T16:08:16.485078Z",
  "epic": {
    "data": {
      "branch_name": "fn-26-code-smells-and-anti-pattern-skills",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-12T16:04:16.869423Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [
        "fn-2-plugin-skeleton-and-infrastructure"
      ],
      "id": "fn-26-code-smells-and-anti-pattern-skills",
      "next_task": 1,
      "plan_review_status": "unknown",
      "plan_reviewed_at": null,
      "spec_path": ".flow/specs/fn-26-code-smells-and-anti-pattern-skills.md",
      "status": "open",
      "title": "Code Smells and Anti-Pattern Skills",
      "updated_at": "2026-02-12T16:05:08.877919Z"
    },
    "spec": "# fn-26: Code Smells and Anti-Pattern Skills\n\n## Overview\nAdds a dedicated code-smell and anti-pattern skill that Claude loads **proactively during all C# workflow modes** (planning, implementation, review). The skill covers common pitfalls that existing skills do not address: IDisposable misuse, warning suppression hacks, LINQ anti-patterns, event handling leaks, and design smells.\n\nThe skill complements (not duplicates) existing coverage:\n- [skill:dotnet-csharp-async-patterns] already covers async gotchas (blocking on `.Result`, `async void`, fire-and-forget)\n- [skill:dotnet-csharp-coding-standards] already covers naming, style, file organization\n- [skill:dotnet-csharp-dependency-injection] already covers captive dependency\n- [skill:dotnet-csharp-nullable-reference-types] already covers NRT annotation mistakes\n- fn-9 `dotnet-agent-gotchas` (planned) will cover LLM-specific generation mistakes\n\nThis epic focuses on the **gap**: general developer-facing code smells that any C# developer (human or AI) should avoid.\n\n## Motivation\n\nReal-world code review feedback like these should be caught proactively:\n1. **Async lambda exception routing**: `TryEnqueue` with async lambda \u2014 exceptions inside the lambda not routed through `TaskCompletionSource`, causing silent failures\n2. **Warning suppression hacks**: Invoking events with `null` args to suppress CS0067 instead of using `#pragma warning disable CS0067` \u2014 creates misleading behavior and masks real bugs\n\nThese are NOT currently covered by any existing skill.\n\n## Scope\n\n**Skills (1 new):**\n- `dotnet-csharp-code-smells` \u2014 Proactive code smell and anti-pattern detection during writing, reviewing, or planning C# code\n\n**Scope boundary with fn-9:** This skill covers general .NET code smells (patterns any developer should avoid). fn-9's `dotnet-agent-gotchas` covers LLM-specific generation mistakes (wrong NuGet packages, bad project structure, MSBuild errors). Cross-reference: `[skill:dotnet-agent-gotchas]` for LLM-specific mistakes.\n\n**Scope boundary with fn-4:** `dotnet-add-analyzers` configures Roslyn analyzers (CA rules). This skill documents which patterns to watch for during code review and planning, complementing (not replacing) static analysis. Where a CA rule exists, the skill references it (e.g., \"CA2000 already catches this \u2014 ensure analyzers are enabled\").\n\n## Anti-Pattern Categories to Cover (gaps only)\n\n| Category | What's Missing | Already Covered By |\n|----------|---------------|-------------------|\n| Resource management (IDisposable) | Missing `using`, undisposed fields, wrong Dispose pattern | \u2014 (NOT covered) |\n| Warning suppression hacks | Invoking events with `null` to suppress CS0067, dummy assignments | \u2014 (NOT covered) |\n| LINQ misuse | Premature `.ToList()`, client-side evaluation, multiple enumeration | \u2014 (NOT covered) |\n| Event handling leaks | Not unsubscribing, raising in constructor, `async void` handler misuse | Partially by concurrency specialist agent |\n| Design smells | God classes, long methods (>30 lines), long parameter lists (>5 params) | \u2014 (NOT covered) |\n| Exception handling | Empty catch, catching base `Exception`, swallowing with log-only | Partially by [skill:dotnet-csharp-async-patterns] (fire-and-forget section) |\n| String abuse | Concatenation in loops, missing `StringComparison`, raw string over interpolation | Partially by [skill:dotnet-csharp-coding-standards] |\n| Mutable static state | `static` mutable fields without synchronization | Covered by concurrency specialist agent |\n\nCategories marked \"NOT covered\" are the primary focus. Categories marked \"Partially\" get brief mentions with cross-references.\n\n## \"Always-On\" Triggering Strategy\n\nThe skill uses a broad `description` field to match virtually any C# interaction:\n```yaml\ndescription: \"WHEN writing, reviewing, or planning C# code. Catches code smells, anti-patterns, and common pitfalls.\"\n```\n\nThis triggers the skill during ALL workflow modes. To manage context size:\n1. Keep SKILL.md body concise (<300 lines) with a checklist format\n2. Move detailed examples and explanations to supporting files (e.g., `details.md`)\n3. Structure as scannable table, not prose \u2014 the agent needs to quickly identify relevant patterns\n\n## Key Context\n\n- Description budget: currently 3,085 chars across 25 skills. Adding ~95 chars. Well within 12,000 WARN threshold.\n- Existing `dotnet-advisor` routing table needs a new entry for the code-smell skill.\n- `fn-1` umbrella spec and `docs/dotnet-artisan-spec.md` need updated skill counts.\n- Validation: `./scripts/validate-skills.sh` must pass after adding new SKILL.md.\n\n## Quick Commands\n```bash\n# Verify skill exists and has frontmatter\ntest -f skills/core-csharp/dotnet-csharp-code-smells/SKILL.md && echo OK || echo MISSING\ngrep \"^name:\" skills/core-csharp/dotnet-csharp-code-smells/SKILL.md\ngrep \"^description:\" skills/core-csharp/dotnet-csharp-code-smells/SKILL.md\n\n# Validate all skills pass\n./scripts/validate-skills.sh\n\n# Check budget impact\ngrep CURRENT_DESC_CHARS < <(./scripts/validate-skills.sh 2>&1)\n```\n\n## Acceptance Criteria\n1. `dotnet-csharp-code-smells` skill exists at `skills/core-csharp/dotnet-csharp-code-smells/SKILL.md` with `name` and `description` frontmatter\n2. Description uses the broad \"WHEN writing, reviewing, or planning C# code\" pattern to trigger during all modes\n3. Skill covers at minimum: IDisposable misuse, warning suppression hacks, LINQ anti-patterns, event handling leaks, design smells\n4. Each anti-pattern entry includes: the smell, why it's harmful, the fix, and a cross-reference to the relevant skill or CA rule\n5. Skill body is <300 lines; detailed examples are in supporting files\n6. No duplication with existing skills \u2014 cross-references for already-covered patterns (async gotchas \u2192 [skill:dotnet-csharp-async-patterns], naming \u2192 [skill:dotnet-csharp-coding-standards])\n7. Scope boundary with fn-9 is documented (general code smells vs LLM-specific mistakes)\n8. Registered in `plugin.json` skills array\n9. Added to `dotnet-advisor` skill catalog (section 2: Core C#) and routing logic\n10. `./scripts/validate-skills.sh` passes with `BUDGET_STATUS=OK` or `BUDGET_STATUS=WARN`\n11. Updated: `docs/dotnet-artisan-spec.md` Core C# section skill count, `fn-1` umbrella spec fn-3 row\n\n## References\n- Microsoft Code Quality Rules: https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/\n- David Fowler Async Guidance: https://github.com/davidfowl/AspNetCoreDiagnosticScenarios/blob/master/AsyncGuidance.md\n- Framework Design Guidelines: https://learn.microsoft.com/en-us/dotnet/standard/design-guidelines/\n- Microsoft Engineering C# Code Review Checklist: https://microsoft.github.io/code-with-engineering-playbook/code-reviews/recipes/csharp/\n- CS0067 Best Practices: https://learn.microsoft.com/en-us/dotnet/csharp/misc/cs0067\n"
  },
  "epic_id": "fn-26-code-smells-and-anti-pattern-skills",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-12T16:05:10.111159Z",
        "depends_on": [],
        "epic": "fn-26-code-smells-and-anti-pattern-skills",
        "id": "fn-26-code-smells-and-anti-pattern-skills.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-26-code-smells-and-anti-pattern-skills.1.md",
        "status": "todo",
        "title": "Create dotnet-csharp-code-smells skill",
        "updated_at": "2026-02-12T16:05:36.408932Z"
      },
      "id": "fn-26-code-smells-and-anti-pattern-skills.1",
      "runtime": null,
      "spec": "# fn-26-code-smells-and-anti-pattern-skills.1 Create dotnet-csharp-code-smells skill\n\n## Description\nCreate the `dotnet-csharp-code-smells` SKILL.md at `skills/core-csharp/dotnet-csharp-code-smells/SKILL.md`. This skill provides proactive code-smell and anti-pattern detection that triggers during ALL C# workflow modes (planning, implementation, review).\n\n**Size:** M\n**Files:**\n- `skills/core-csharp/dotnet-csharp-code-smells/SKILL.md` (main skill)\n- `skills/core-csharp/dotnet-csharp-code-smells/details.md` (supporting file with detailed examples)\n\n## Approach\n\n- Follow the SKILL.md pattern at `skills/core-csharp/dotnet-csharp-coding-standards/SKILL.md` for frontmatter format\n- Use broad description: `\"WHEN writing, reviewing, or planning C# code. Catches code smells, anti-patterns, and common pitfalls.\"`\n- Structure body as scannable checklist/table (not prose) \u2014 the agent needs to quickly identify relevant patterns\n- Each anti-pattern entry: Smell | Why harmful | Fix | CA rule or cross-ref\n- Keep SKILL.md under 300 lines; put detailed code examples in `details.md` supporting file\n- Cross-reference existing skills for already-covered patterns:\n  - Async gotchas \u2192 `[skill:dotnet-csharp-async-patterns]`\n  - Naming/style \u2192 `[skill:dotnet-csharp-coding-standards]`\n  - DI lifetime misuse \u2192 `[skill:dotnet-csharp-dependency-injection]`\n  - NRT mistakes \u2192 `[skill:dotnet-csharp-nullable-reference-types]`\n  - LLM-specific mistakes \u2192 `[skill:dotnet-agent-gotchas]` (fn-9, planned)\n- Cover these UNCOVERED categories (the gaps):\n  1. **Resource management**: Missing `using`/IDisposable, undisposed fields, wrong Dispose pattern (ref CA2000, CA2213)\n  2. **Warning suppression hacks**: Invoking events with `null` to suppress CS0067, dummy variable assignments. Correct alternatives: `#pragma warning disable CS0067` or explicit event accessors `{ add {} remove {} }`\n  3. **LINQ anti-patterns**: Premature `.ToList()` in middle of chains, multiple enumeration of IEnumerable, client-side evaluation in EF Core\n  4. **Event handling leaks**: Not unsubscribing (memory leaks), raising events in constructor, async void event handlers (only valid use of async void)\n  5. **Design smells**: God classes (>500 lines), methods >30 lines, parameter lists >5 params, feature envy\n  6. **Exception handling gaps**: Empty catch blocks, catching base `Exception` (CA1031), swallowing with log-only, throwing in finally\n\n## Key context\n\n- The user's motivating examples:\n  - `TryEnqueue` with async lambda: exceptions not routed through `TaskCompletionSource` \u2014 document under \"async exception routing\" with cross-ref to `[skill:dotnet-csharp-async-patterns]`\n  - `SuppressWarnings` invoking events with `null` args \u2014 document under \"warning suppression hacks\" with alternatives: `#pragma warning disable CS0067` or `event Action E { add {} remove {} }`\n- Where CA rules exist for a smell, reference them (so agent knows: \"analyzer already catches this, ensure it's enabled\")\n- Scope boundary: this skill covers general code smells. `dotnet-agent-gotchas` (fn-9) covers LLM-specific generation mistakes. Document this boundary in the skill's Out of Scope section.\n## Acceptance\n- [ ] SKILL.md exists at `skills/core-csharp/dotnet-csharp-code-smells/SKILL.md`\n- [ ] Frontmatter has `name: dotnet-csharp-code-smells` and broad description triggering on all C# modes\n- [ ] Covers IDisposable misuse with CA2000/CA2213 references\n- [ ] Covers warning suppression hacks (CS0067 examples, correct alternatives)\n- [ ] Covers LINQ anti-patterns (premature materialization, multiple enumeration, client-side eval)\n- [ ] Covers event handling leaks (unsubscribe, constructor raising, async void handlers)\n- [ ] Covers design smells (God classes, long methods, long parameter lists)\n- [ ] Covers exception handling gaps (empty catch, base Exception, log-and-swallow)\n- [ ] Each entry has: Smell | Why harmful | Fix | CA rule or cross-ref\n- [ ] Cross-references existing skills (not duplicating their content)\n- [ ] Scope boundary with fn-9 documented in Out of Scope section\n- [ ] SKILL.md body <300 lines; detailed examples in `details.md`\n- [ ] Supporting `details.md` file with code examples for each anti-pattern category\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-12T16:05:11.839370Z",
        "depends_on": [
          "fn-26-code-smells-and-anti-pattern-skills.1"
        ],
        "epic": "fn-26-code-smells-and-anti-pattern-skills",
        "id": "fn-26-code-smells-and-anti-pattern-skills.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-26-code-smells-and-anti-pattern-skills.2.md",
        "status": "todo",
        "title": "Register skill and update catalog docs",
        "updated_at": "2026-02-12T16:05:49.094679Z"
      },
      "id": "fn-26-code-smells-and-anti-pattern-skills.2",
      "runtime": null,
      "spec": "# fn-26-code-smells-and-anti-pattern-skills.2 Register skill and update catalog docs\n\n## Description\nRegister the new `dotnet-csharp-code-smells` skill in plugin infrastructure and update all catalog docs to reflect the addition.\n\n**Size:** S\n**Files:**\n- `.claude-plugin/plugin.json` (add skill path)\n- `skills/foundation/dotnet-advisor/SKILL.md` (add catalog entry + routing)\n- `docs/dotnet-artisan-spec.md` (update Core C# section skill count and list)\n- `.flow/specs/fn-1-dotnet-artisan-comprehensive-net-coding.md` (update wave table fn-3 count if applicable, or add fn-26 to wave table)\n\n## Approach\n\n- Add `\"skills/core-csharp/dotnet-csharp-code-smells\"` to plugin.json skills array\n- Add catalog entry in dotnet-advisor SKILL.md section 2 (Core C#): `[skill:dotnet-csharp-code-smells]` with brief routing description\n- Add routing logic entry so the advisor routes to this skill when code review or code quality topics arise\n- Update `docs/dotnet-artisan-spec.md` Core C# section with new skill bullet and updated count\n- Update fn-1 umbrella spec with fn-26 in the appropriate wave\n- Run `./scripts/validate-skills.sh` and verify `BUDGET_STATUS=OK` or `BUDGET_STATUS=WARN`\n\n## Key context\n\n- Follow convention at `skills/foundation/dotnet-advisor/SKILL.md` for catalog and routing format\n- Plugin.json pattern: `\"skills/core-csharp/dotnet-csharp-modern-patterns\"` (no trailing slash)\n- Cross-reference IDs must use canonical name: `dotnet-csharp-code-smells`\n- Budget math: current 3,085 chars + ~95 chars = ~3,180 chars (well within 12,000 WARN)\n## Acceptance\n- [ ] `plugin.json` skills array includes `\"skills/core-csharp/dotnet-csharp-code-smells\"`\n- [ ] `dotnet-advisor` SKILL.md has catalog entry for `[skill:dotnet-csharp-code-smells]` in section 2\n- [ ] `dotnet-advisor` routing logic updated to route code quality/review queries to the new skill\n- [ ] `docs/dotnet-artisan-spec.md` Core C# section updated with new skill and count\n- [ ] `fn-1` umbrella spec updated with fn-26 in wave table\n- [ ] `./scripts/validate-skills.sh` passes with `BUDGET_STATUS=OK` or `BUDGET_STATUS=WARN`\n- [ ] No cross-reference uses bare skill name (all use `[skill:dotnet-csharp-code-smells]` syntax)\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    }
  ]
}
