{
  "created_at": "2026-02-12T23:34:45.696267Z",
  "epic": {
    "data": {
      "branch_name": "fn-10-version-detection-and-multi-targeting",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-11T22:23:18.213449Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [
        "fn-2-plugin-skeleton-and-infrastructure"
      ],
      "id": "fn-10-version-detection-and-multi-targeting",
      "next_task": 1,
      "plan_review_status": "ship",
      "plan_reviewed_at": "2026-02-12T22:52:06.795065Z",
      "spec_path": ".flow/specs/fn-10-version-detection-and-multi-targeting.md",
      "status": "open",
      "title": "Version Detection and Multi-Targeting Skills",
      "updated_at": "2026-02-12T22:52:06.795193Z"
    },
    "spec": "# fn-10: Version Detection & Multi-Targeting\n\n## Overview\nDelivers two skills that build on the existing `dotnet-version-detection` foundation skill: multi-targeting strategies with polyfill emphasis, and .NET version upgrade guidance.\n\n**Responsibility boundary:** `dotnet-version-detection` (fn-2/foundation) owns all detection logic (TFM resolution, SDK version, preview feature flags). This epic's skills **consume** detected outputs and provide strategy/guidance only \u2014 they never re-implement detection.\n\n## Scope\n**Skills (2):**\n- `dotnet-multi-targeting` \u2192 `skills/multi-targeting/dotnet-multi-targeting/SKILL.md` \u2014 Multi-targeting strategies with polyfill-first approach: PolySharp, SimonCropp/Polyfill, conditional compilation for runtime gaps, API compat analyzers\n- `dotnet-version-upgrade` \u2192 `skills/multi-targeting/dotnet-version-upgrade/SKILL.md` \u2014 Modern .NET version upgrades with defined upgrade lanes and polyfill bridge strategies\n\n## Key Context\n- `dotnet-version-detection` already handles TFM detection from .csproj, Directory.Build.props, global.json and cross-references both new skills\n- New skills consume the structured output from version detection and provide actionable guidance\n- PolySharp and SimonCropp/Polyfill enable latest C# language features on older TFMs (compile-time polyfills)\n- Conditional compilation (`#if`) remains necessary for runtime/API behavior gaps that polyfills cannot cover\n- API compatibility analyzers (`EnablePackageValidation`, `ApiCompat`) validate multi-targeting correctness\n\n### Decision Matrix: Polyfill vs Conditional Compilation\n| Gap Type | Strategy | Example |\n|----------|----------|---------|\n| Language/syntax feature | Polyfill (PolySharp/Polyfill) | `required` modifier, `init` properties, collection expressions on net8.0 |\n| BCL API addition | Polyfill if available, else `#if` | `System.Threading.Lock` on net8.0 via Polyfill |\n| Runtime behavior difference | Conditional compilation or adapter | Runtime-async (net11.0 only), different GC modes |\n| Platform API divergence | Conditional compilation with `[SupportedOSPlatform]` | Windows-only APIs, Android-specific features |\n\n### Upgrade Lanes\n| Lane | Path | Use Case |\n|------|------|----------|\n| Production (default) | net8.0 \u2192 net10.0 | LTS-to-LTS, recommended for most apps |\n| Staged production | net8.0 \u2192 net9.0 \u2192 net10.0 | When ecosystem dependencies require incremental migration |\n| Experimental | net10.0 \u2192 net11.0 (preview) | Non-production only, exploring upcoming features |\n\n**.NET 9 note:** While .NET 9 is STS and approaching end-of-support (May 2026), staging through .NET 9 may be necessary when third-party packages or breaking changes require incremental migration.\n\n## Quick Commands\n```bash\n# Smoke test: verify polyfill coverage in multi-targeting skill\ngrep -i \"PolySharp\\|Polyfill\" skills/multi-targeting/dotnet-multi-targeting/SKILL.md\n\n# Verify decision matrix in multi-targeting skill\ngrep -i \"conditional\\|#if\\|polyfill\" skills/multi-targeting/dotnet-multi-targeting/SKILL.md\n\n# Test upgrade guidance lanes\ngrep -i \"upgrade\\|migration\\|lane\" skills/multi-targeting/dotnet-version-upgrade/SKILL.md\n\n# Verify cross-references\ngrep -i \"\\[skill:\" skills/multi-targeting/*/SKILL.md\n```\n\n## Acceptance Criteria\n1. Both skills written following the standard pattern (frontmatter with `name`+`description`, overview, detailed sections, gotchas, prerequisites, references, cross-references)\n2. Multi-targeting skill includes decision matrix for polyfill vs conditional compilation vs adapter patterns\n3. Multi-targeting skill documents PolySharp and SimonCropp/Polyfill with concrete package references, setup examples, and feature coverage\n4. Multi-targeting skill documents API compatibility validation workflow: `EnablePackageValidation`, `ApiCompat` baseline, pass/fail criteria\n5. Version upgrade skill defines three upgrade lanes (production LTS\u2192LTS, staged through STS, experimental preview) with explicit guardrails\n6. Version upgrade skill covers .NET 9 as a staging option (not skipped), with STS end-of-support context\n7. Both skills consume output from `dotnet-version-detection` \u2014 no re-implementation of TFM detection logic\n8. Cross-references: both skills link to `[skill:dotnet-version-detection]`; `dotnet-version-detection` already links back via `[skill:dotnet-multi-targeting]` and `[skill:dotnet-version-upgrade]`\n9. Skills placed in `skills/multi-targeting/` directory (both skills share this category)\n\n## File Ownership (Parallelization)\nTasks touch **disjoint** files:\n- **fn-10.1**: `skills/multi-targeting/dotnet-multi-targeting/SKILL.md` (creates)\n- **fn-10.2**: `skills/multi-targeting/dotnet-version-upgrade/SKILL.md` (creates)\n\nNo shared file edits needed \u2014 tasks can run fully in parallel.\n\n## Test Notes\n- Verify multi-targeting skill provides correct guidance for sample scenarios:\n  - Single TFM net8.0 project wanting C# 14 features \u2192 PolySharp/Polyfill\n  - Multi-TFM `net8.0;net10.0` project \u2192 polyfill for language features + `#if` for runtime gaps\n  - net11.0 preview with `EnablePreviewFeatures` \u2192 experimental lane guidance\n  - Mismatched global.json/csproj \u2192 consume warning from version-detection, add upgrade guidance\n- Verify upgrade skill provides correct lane selection for:\n  - net8.0 LTS \u2192 net10.0 LTS (direct upgrade)\n  - net8.0 with ecosystem constraints \u2192 staged through net9.0\n  - net10.0 \u2192 net11.0 preview (non-production only)\n- Validate cross-references resolve correctly (no broken `[skill:...]` links)\n- Verify no duplication of detection logic from `dotnet-version-detection`\n\n## References\n\n> **Last verified: 2026-02-12**\n- PolySharp: https://github.com/Sergio0694/PolySharp\n- SimonCropp Polyfill: https://github.com/SimonCropp/Polyfill\n- .NET Multi-Targeting: https://learn.microsoft.com/en-us/dotnet/standard/frameworks\n- .NET Upgrade Assistant: https://dotnet.microsoft.com/en-us/platform/upgrade-assistant\n- Package Validation: https://learn.microsoft.com/en-us/dotnet/fundamentals/package-validation/overview\n- API Compatibility: https://learn.microsoft.com/en-us/dotnet/fundamentals/apicompat/overview\n"
  },
  "epic_id": "fn-10-version-detection-and-multi-targeting",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-11T22:32:01.538888Z",
        "depends_on": [],
        "epic": "fn-10-version-detection-and-multi-targeting",
        "id": "fn-10-version-detection-and-multi-targeting.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-10-version-detection-and-multi-targeting.1.md",
        "status": "todo",
        "title": "Multi-targeting with polyfills skill",
        "updated_at": "2026-02-12T22:50:15.163389Z"
      },
      "id": "fn-10-version-detection-and-multi-targeting.1",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-12T22:53:55.970320Z",
        "evidence": {
          "commits": [
            "3a1ba604e6debd6e2f1f07e0fe38e9b9e9ecf7e0",
            "006ef455101800e7e3490578ca27a36f68560254"
          ],
          "prs": [],
          "tests": [
            "grep -i PolySharp skills/multi-targeting/dotnet-multi-targeting/SKILL.md",
            "grep -i conditional skills/multi-targeting/dotnet-multi-targeting/SKILL.md",
            "grep -i skill: skills/multi-targeting/dotnet-multi-targeting/SKILL.md"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-12T23:03:08.347403Z"
      },
      "spec": "# fn-10-version-detection-and-multi-targeting.1 Multi-targeting with polyfills skill\n\n## Description\nCreate `skills/multi-targeting/dotnet-multi-targeting/SKILL.md` \u2014 a comprehensive skill for .NET multi-targeting strategies with a polyfill-first approach.\n\nThe skill consumes output from `dotnet-version-detection` (TFM, C# version, preview flags) and provides actionable guidance on:\n1. When and how to use PolySharp and SimonCropp/Polyfill for language feature backporting\n2. When conditional compilation (`#if`) is necessary (runtime/API behavior gaps)\n3. API compatibility validation with `EnablePackageValidation` and `ApiCompat`\n4. Multi-targeting `.csproj` setup patterns\n\n**Pattern reference:** Follow the structure of `skills/security/dotnet-secrets-management/SKILL.md` \u2014 frontmatter, overview with scope/out-of-scope/cross-references, detailed sections with code examples, gotchas, prerequisites, references.\n\n### Files to Create\n- `skills/multi-targeting/dotnet-multi-targeting/SKILL.md`\n\n### Files NOT to Modify\n- `skills/foundation/dotnet-version-detection/SKILL.md` (already has cross-references)\n\n## Acceptance\n- [ ] SKILL.md created at `skills/multi-targeting/dotnet-multi-targeting/SKILL.md`\n- [ ] Frontmatter has `name: dotnet-multi-targeting` and `description` following WHEN/WHEN NOT pattern\n- [ ] Decision matrix: polyfill vs conditional compilation vs adapter pattern for each gap type (language, BCL API, runtime behavior, platform API)\n- [ ] PolySharp section: package reference, what it provides (compiler-synthesized polyfills for `required`, `init`, `SetsRequiredMembers`, etc.), setup in .csproj\n- [ ] SimonCropp/Polyfill section: package reference, what it provides (BCL API polyfills like `System.Threading.Lock`), setup in .csproj\n- [ ] Conditional compilation section: when `#if` is correct (runtime gaps), patterns for TFM-specific code\n- [ ] API compatibility section: `EnablePackageValidation` setup, `ApiCompat` baseline workflow, pass/fail interpretation\n- [ ] Multi-targeting .csproj patterns: `<TargetFrameworks>`, conditional `<PackageReference>`, TFM-specific source files\n- [ ] Gotchas section with at least 5 agent-relevant gotchas\n- [ ] Cross-references to `[skill:dotnet-version-detection]` and `[skill:dotnet-version-upgrade]`\n- [ ] Prerequisites section\n- [ ] References section with source URLs\n- [ ] No TFM/SDK detection algorithm implemented \u2014 guidance consumes `dotnet-version-detection` output only\n- [ ] \"Last verified\" date included in skill references/metadata\n\n## Done summary\nCreated dotnet-multi-targeting SKILL.md with polyfill-first multi-targeting strategy covering PolySharp, SimonCropp/Polyfill, conditional compilation patterns, multi-targeting csproj setup, and API compatibility validation with EnablePackageValidation and ApiCompat.\n## Evidence\n- Commits: 3a1ba604e6debd6e2f1f07e0fe38e9b9e9ecf7e0, 006ef455101800e7e3490578ca27a36f68560254\n- Tests: grep -i PolySharp skills/multi-targeting/dotnet-multi-targeting/SKILL.md, grep -i conditional skills/multi-targeting/dotnet-multi-targeting/SKILL.md, grep -i skill: skills/multi-targeting/dotnet-multi-targeting/SKILL.md\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-11T22:32:01.657855Z",
        "depends_on": [],
        "epic": "fn-10-version-detection-and-multi-targeting",
        "id": "fn-10-version-detection-and-multi-targeting.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-10-version-detection-and-multi-targeting.2.md",
        "status": "todo",
        "title": "Version upgrade guidance skill",
        "updated_at": "2026-02-12T22:50:32.375410Z"
      },
      "id": "fn-10-version-detection-and-multi-targeting.2",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-12T23:12:31.267174Z",
        "evidence": {
          "commits": [
            "82ba908",
            "a022c3e",
            "b399b0baaebfba8f9bb3d4db4dff53e6e4fa602c"
          ],
          "prs": [],
          "tests": [
            "grep verification of acceptance criteria"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-12T23:32:26.097188Z"
      },
      "spec": "# fn-10-version-detection-and-multi-targeting.2 Version upgrade guidance skill\n\n## Description\nCreate `skills/multi-targeting/dotnet-version-upgrade/SKILL.md` \u2014 a comprehensive skill for .NET version upgrade guidance with defined upgrade lanes.\n\nThe skill consumes output from `dotnet-version-detection` (current TFM, SDK version, preview flags) and provides actionable upgrade guidance based on three upgrade lanes:\n1. **Production (LTS\u2192LTS):** net8.0 \u2192 net10.0 \u2014 direct upgrade for most apps\n2. **Staged production:** net8.0 \u2192 net9.0 \u2192 net10.0 \u2014 when ecosystem dependencies require incremental migration\n3. **Experimental:** net10.0 \u2192 net11.0 (preview) \u2014 non-production exploration of upcoming features\n\n**Pattern reference:** Follow the structure of `skills/security/dotnet-secrets-management/SKILL.md` \u2014 frontmatter, overview with scope/out-of-scope/cross-references, detailed sections with code examples, gotchas, prerequisites, references.\n\n### Files to Create\n- `skills/multi-targeting/dotnet-version-upgrade/SKILL.md`\n\n### Files NOT to Modify\n- `skills/foundation/dotnet-version-detection/SKILL.md` (already has cross-references)\n\n## Acceptance\n- [ ] SKILL.md created at `skills/multi-targeting/dotnet-version-upgrade/SKILL.md`\n- [ ] Frontmatter has `name: dotnet-version-upgrade` and `description` following WHEN/WHEN NOT pattern\n- [ ] Three upgrade lanes documented with explicit guardrails:\n  - Production: net8.0 \u2192 net10.0 (LTS-to-LTS, recommended default)\n  - Staged: net8.0 \u2192 net9.0 \u2192 net10.0 (when ecosystem requires incremental steps)\n  - Experimental: net10.0 \u2192 net11.0 preview (non-production only, explicit warnings)\n- [ ] .NET 9 documented as valid staging option (STS, end-of-support May 2026), not skipped\n- [ ] Upgrade checklist per lane: TFM update, package updates, breaking change review, deprecated API replacement, test validation\n- [ ] `dotnet-outdated` or equivalent tooling documented for detecting stale packages\n- [ ] .NET Upgrade Assistant coverage (when useful, limitations)\n- [ ] Breaking change detection patterns: `dotnet build` warnings, analyzer diagnostics, API diff tools\n- [ ] Preview feature opt-in guidance: `LangVersion=preview`, `EnablePreviewFeatures`, runtime-async flag\n- [ ] Gotchas section with at least 5 agent-relevant gotchas (e.g., STS support windows, preview feature stability, TFM-conditional package references)\n- [ ] Cross-references to `[skill:dotnet-version-detection]` and `[skill:dotnet-multi-targeting]`\n- [ ] Prerequisites section\n- [ ] References section with source URLs\n- [ ] No TFM/SDK detection algorithm implemented \u2014 guidance consumes `dotnet-version-detection` output only\n- [ ] \"Last verified\" date included in skill references/metadata\n\n## Done summary\nCreated dotnet-version-upgrade skill with three upgrade lanes (LTS-to-LTS, staged STS, experimental preview), breaking change detection, package update strategies, and preview feature guidance. Fixed review feedback on package version pinning and Regex classification.\n## Evidence\n- Commits: 82ba908, a022c3e, b399b0baaebfba8f9bb3d4db4dff53e6e4fa602c\n- Tests: grep verification of acceptance criteria\n- PRs:"
    }
  ]
}
