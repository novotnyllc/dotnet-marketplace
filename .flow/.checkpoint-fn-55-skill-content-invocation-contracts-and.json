{
  "created_at": "2026-02-20T09:38:47.516980Z",
  "epic": {
    "data": {
      "branch_name": "fn-55-skill-content-invocation-contracts-and",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-19T23:00:27.106168Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [
        "fn-53-skill-routing-language-hardening",
        "fn-54-agent-routing-harness-determinism-and"
      ],
      "id": "fn-55-skill-content-invocation-contracts-and",
      "next_task": 1,
      "plan_review_status": "ship",
      "plan_reviewed_at": "2026-02-20T08:12:19.180963Z",
      "spec_path": ".flow/specs/fn-55-skill-content-invocation-contracts-and.md",
      "status": "open",
      "title": "Skill Content Invocation Contracts and Validation",
      "updated_at": "2026-02-20T08:12:19.181283Z"
    },
    "spec": "# Skill Content Invocation Contracts and Validation\n\n## Overview\n\nStrengthen SKILL.md content so invocation signals are explicit, testable, and validated in CI. Define the invocation contract spec, update high-traffic skills, extend the validator with contract compliance checks, add content regression test cases, and establish cross-provider change policy.\n\n**PRD:** `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n**PRD amendment:** Agent updates (agents/*.md) deferred to a follow-up epic. Agents don't use `## Scope`/`## Out of scope` format \u2014 a separate invocation-signal convention for agents is needed before updating them. PRD Workstream B.2 and Acceptance Criteria #6 to be updated with deferral note.\n\n## Scope\n\n- Define invocation contract as purely structural, machine-checkable rules for SKILL.md\n- Update skill-routing-style-guide.md with invocation contract section\n- Update the 14 skills in cases.json corpus with stronger signals (NO agents/*.md)\n- Extend _validate_skills.py with structural invocation-contract checks\n- Add positive/negative control test cases (requires fn-54 runner + baseline)\n- Establish cross-provider change policy with operator-grade checklist\n- Fix PRD: epic reference (fn-57 \u2192 fn-55) + agent update deferral note across all locations\n\n## Design decisions\n\n- **Invocation contract \u2014 3 structural rules (unordered bullets only):**\n  1. `## Scope` contains \u22651 unordered bullet (`- `) within section boundaries\n  2. `## Out of scope` contains \u22651 unordered bullet (`- `) within section boundaries\n  3. At least one OOS bullet contains a `[skill:<id>]` reference string (presence; resolution governed by STRICT_REFS)\n  - Unordered (`- `) only. Numbered lists do NOT count.\n  - No \"Use when:\" phrasing requirement.\n- **Rule #3 is a NEW dedicated check:** Separate from STRICT_REFS resolution. Rule #3 checks `[skill:` string presence inside OOS bullets; STRICT_REFS checks that referenced skill IDs actually exist. Both can be enabled/disabled independently.\n- **Validation split:** STRICT_INVOCATION (presence) vs STRICT_REFS (resolution) \u2014 independent controls. Documented in BOTH `docs/skill-routing-style-guide.md` (new Invocation Contract section) AND `scripts/validate-skills.sh` (header comments).\n- **STRICT_INVOCATION mechanism:** `_validate_skills.py` reads `STRICT_INVOCATION` env var directly (same pattern as Python-level env reads). When set to `1`, contract warnings become errors.\n- **Stable output format:** Contract warnings use `INVOCATION_CONTRACT:` prefix in the warning message. Exact format matches existing validator convention:\n  ```\n  WARN:  skills/<cat>/<name>/SKILL.md -- INVOCATION_CONTRACT: <description>\n  ```\n  Summary key `INVOCATION_CONTRACT_WARN_COUNT=<N>` emitted by `_validate_skills.py` (Python), propagated through `validate-skills.sh` output.\n- **Warning duplication during rollout:** A skill missing `## Scope` entirely will produce both the existing `missing '## Scope' section` warning AND the new `INVOCATION_CONTRACT: Scope section has 0 unordered bullets` warning. This is expected and correct during rollout \u2014 both warnings serve distinct purposes (structural presence vs contract compliance). Consolidation deferred until STRICT_INVOCATION is enabled by default.\n- **WARN\u2192ERROR rollout:** Default WARN. CI flip after compliance. Rollout playbook in style guide.\n- **Skill scope:** 14 cases.json skills + dotnet-advisor routing catalog. NO agents/*.md \u2014 deferred (see PRD amendment).\n- **Test case dependency:** Hard fn-54 prerequisite. Baseline updates required. Integration proved via runner mismatch classifications in JSON output.\n- **T4 case design for observability:** At least one disallowed case must use a prompt crafted to likely trigger the disallowed skill, so `failure_kind == \"disallowed_hit\"` is actually observable. At least one optional case must use a prompt likely to trigger the optional skill, so `optional_hits[]` is populated. Note: disallowed cases that produce `disallowed_hit` are expected failures \u2014 acceptance criteria must distinguish positive cases (expected pass) from control cases (expected outcomes per baseline).\n- **Cross-provider policy:** 3 concrete operator-grade bullets.\n- **Budget check:** `BUDGET_STATUS != FAIL` (i.e., `CURRENT_DESC_CHARS < 15600`) \u2014 aligned with validator semantics.\n\n## Task ordering\n\n```\nT1 (contract spec + style guide + PRD fixes) \u2192 T2 (validator checks)\n                                               \u2192 T3 (skill content updates)\nT3 \u2192 T4 (test cases + baseline) [after fn-54 merged + T3 ready]\nT1 \u2192 T5 (cross-provider policy)\n```\n\n**Shared file note:** T1 and T5 both edit `CONTRIBUTING-SKILLS.md` (T1: section 8 checklist; T5: section 5 testing pointer). They are disjoint sections but same file. T5 already depends on T1, ensuring sequential access. Implementers should be aware of this overlap.\n\n## Quick commands\n\n```bash\n./scripts/validate-skills.sh\n./test.sh --agents claude --category foundation,testing\n./scripts/validate-skills.sh 2>&1 | grep BUDGET\n```\n\n## Acceptance\n\n- [ ] Invocation contract in style guide: 3 structural rules, unordered bullets only\n- [ ] Contract separates presence (STRICT_INVOCATION) from resolution (STRICT_REFS)\n- [ ] STRICT split documented in both style guide AND validate-skills.sh header comments\n- [ ] Rule #3 (OOS `[skill:]` presence) implemented as dedicated check, independent of STRICT_REFS\n- [ ] All 14 cases.json skills have \u22651 Scope `- ` bullet and \u22651 OOS `- ` bullet with `[skill:name]`\n- [ ] No agents/*.md modified (deferred)\n- [ ] Validator: section-bounded, unordered only, fence-aware, WARN default\n- [ ] Contract warnings use exact format: `WARN:  <path> -- INVOCATION_CONTRACT: <description>`\n- [ ] `INVOCATION_CONTRACT_WARN_COUNT` emitted by Python, propagated through shell wrapper\n- [ ] `STRICT_INVOCATION=1` promotes to ERROR \u2014 toggle proved via exit code AC\n- [ ] \u22653 positive cases (expected pass), \u22652 disallowed control cases, \u22651 optional control case; baseline updated\n- [ ] New positive cases pass with `--agents claude` locally\n- [ ] At least one disallowed case yields `failure_kind == disallowed_hit` consistent with `provider-baseline.json`\n- [ ] At least one optional case populates `optional_hits[]` in runner output\n- [ ] CONTRIBUTING.md cross-provider policy with 3 operator-grade bullets\n- [ ] PRD: fn-57 \u2192 fn-55 + agent update deferral note (Document Control, Workstream B.2, AC #6)\n- [ ] `BUDGET_STATUS != FAIL` (CURRENT_DESC_CHARS < 15600)\n- [ ] All existing validation and tests pass\n\n## References\n\n- PRD: `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n- Predecessor: fn-53; Depends on: fn-54\n- Key files: `docs/skill-routing-style-guide.md`, `scripts/_validate_skills.py`, `tests/agent-routing/cases.json`, `CONTRIBUTING.md`, `CONTRIBUTING-SKILLS.md`\n"
  },
  "epic_id": "fn-55-skill-content-invocation-contracts-and",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.793499Z",
        "depends_on": [],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.1.md",
        "status": "todo",
        "title": "Define invocation contract spec and update style guide",
        "updated_at": "2026-02-20T08:04:50.974519Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.1",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-20T08:14:12.611283Z",
        "evidence": {
          "commits": [
            "8456661d2f1211646b67f2c09eb8f7399b51644f"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-20T08:22:53.063511Z"
      },
      "spec": "# fn-55-skill-content-invocation-contracts-and.1 Define invocation contract spec and update style guide\n\n## Description\nDefine a purely structural, machine-checkable invocation contract spec for SKILL.md. Document validation split. Include rollout playbook. Fix PRD: epic reference + agent update deferral across all locations.\n\n**Size:** M\n**Files:** `docs/skill-routing-style-guide.md`, `CONTRIBUTING-SKILLS.md`, `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n\n## Approach\n\n- Add \"Invocation Contract\" section to style guide with 3 structural rules:\n  1. Scope contains \u22651 `- ` bullet within section boundaries\n  2. OOS contains \u22651 `- ` bullet within section boundaries\n  3. At least one OOS bullet contains `[skill:<id>]` string (presence only \u2014 independent of STRICT_REFS resolution)\n- Unordered (`- `) only. Numbered lists do NOT count. Explicit statement.\n- Validation split documentation (include in BOTH locations):\n  - Style guide: `STRICT_INVOCATION=1` \u2192 contract warnings become errors (exit 1)\n  - Style guide: `STRICT_REFS=1` \u2192 unresolved `[skill:]` becomes errors (exit 1)\n  - Explicit statement: these are independent toggles\n- No \"Use when:\" phrasing requirement.\n- Positive/negative examples using cases.json skills\n- \"Rollout Playbook\" paragraph: WARN-only \u2192 STRICT_INVOCATION=1 after 130 skills compliant\n- CONTRIBUTING-SKILLS.md section 8 checklist item\n- PRD fixes (ALL agent-mentioning locations must be addressed):\n  - Document Control (line 10): `fn-57` \u2192 `fn-55`\n  - Workstream B.2: add note that agent updates (agents/*.md) are deferred \u2014 agents don't use Scope/OOS format, separate convention needed\n  - Acceptance Criteria #6: add deferral note so AC doesn't contradict epic scope\n  - Any other locations referencing agent updates: add consistent deferral language\n\n## Key context\n\n- Style guide already covers description formula, scope format, cross-ref syntax\n- Agent files (agents/*.md) use a different structure than skills \u2014 invocation contract applies to SKILL.md only\n- PRD originally scoped \"skill and agent updates\" but agents need a different convention first\n\n## Acceptance\n- [ ] `grep \"Invocation Contract\" docs/skill-routing-style-guide.md` finds section\n- [ ] 3 structural rules, unordered bullets only, numbered lists excluded\n- [ ] Rule #3 documented as presence check independent of STRICT_REFS resolution\n- [ ] STRICT_INVOCATION vs STRICT_REFS split documented with explicit independence statement\n- [ ] NO \"Use when:\" requirement stated\n- [ ] Examples included\n- [ ] Rollout playbook paragraph\n- [ ] CONTRIBUTING-SKILLS.md checklist item\n- [ ] PRD: fn-57 \u2192 fn-55 corrected (Document Control)\n- [ ] PRD: Workstream B.2 agent deferral note added\n- [ ] PRD: AC #6 agent deferral note added\n\n## Done summary\nDefined the invocation contract spec (3 structural rules for SKILL.md) in the style guide section 6, documented STRICT_INVOCATION vs STRICT_REFS as independent toggles in both the style guide and validate-skills.sh header, added invocation contract checklist item to CONTRIBUTING-SKILLS.md section 8, and fixed the PRD (fn-57 -> fn-55, agent deferral notes in Workstream B.2, AC #6, and Rollout Phase 3).\n## Evidence\n- Commits: 8456661d2f1211646b67f2c09eb8f7399b51644f\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.893677Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.2.md",
        "status": "todo",
        "title": "Add invocation-contract compliance checks to validator",
        "updated_at": "2026-02-20T08:09:53.993791Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.2",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-20T08:27:21.901447Z",
        "evidence": {
          "commits": [
            "1ec8a8c",
            "bde2242",
            "9d20213",
            "57e1e7f",
            "2995ab5"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh",
            "python3 unit tests for fence-aware functions",
            "STRICT_INVOCATION=1 toggle verification"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-20T08:41:01.349241Z"
      },
      "spec": "# fn-55-skill-content-invocation-contracts-and.2 Add invocation-contract compliance checks to validator\n\n## Description\nAdd structural invocation-contract checks with fence-aware section extraction (applied to all section checks for consistency), stable grep-friendly markers, and STRICT_INVOCATION toggle.\n\n**Size:** M\n**Files:** `scripts/_validate_skills.py`, `scripts/validate-skills.sh`\n\n## Approach\n\n- **Fence-awareness for ALL section checks:** Make `has_section_header()`, `extract_oos_items()`, and new `extract_scope_items()` all fence-aware. Same `in_fence` toggle (lines starting with ```) applied consistently. This ensures all scope/OOS-related checks agree on what \"real markdown structure\" means \u2014 no contradictory output.\n- Add `extract_scope_items(content)`: section-bounded (enter `^## Scope$`, exit next `^## `), fence-aware, `- ` only\n- Contract checks (all fence-aware):\n  1. Scope \u22651 `- ` bullet\n  2. OOS \u22651 `- ` bullet\n  3. OOS contains \u22651 `[skill:<id>]` string \u2014 this is a NEW dedicated check, separate from STRICT_REFS. STRICT_REFS checks resolution (does the referenced skill exist); this check verifies presence of `[skill:` string inside OOS bullets regardless of resolution.\n- **Stable output format:** Contract warnings use `INVOCATION_CONTRACT:` prefix in the warning message. Exact format matches existing validator convention:\n  ```\n  WARN:  skills/<cat>/<name>/SKILL.md -- INVOCATION_CONTRACT: Scope section has 0 unordered bullets (requires \u22651)\n  WARN:  skills/<cat>/<name>/SKILL.md -- INVOCATION_CONTRACT: Out of scope section has 0 unordered bullets (requires \u22651)\n  WARN:  skills/<cat>/<name>/SKILL.md -- INVOCATION_CONTRACT: No OOS bullet contains [skill:] reference\n  ```\n  This enables T3's grep-based acceptance to filter by skill path and marker prefix.\n- **Summary key:** `_validate_skills.py` emits `INVOCATION_CONTRACT_WARN_COUNT=<N>` to stdout. `validate-skills.sh` propagates this to output.\n- **STRICT_INVOCATION mechanism:** `_validate_skills.py` reads `STRICT_INVOCATION` env var directly. When `1`, contract warnings become errors (exit 1). Default WARN (exit 0).\n- **validate-skills.sh header comments:** Already added by T1 (lines 17-24, 43 in validate-skills.sh). Verify presence; do not duplicate.\n<!-- Updated by plan-sync: fn-55.1 already added STRICT_INVOCATION/STRICT_REFS header docs and INVOCATION_CONTRACT_WARN_COUNT output key to validate-skills.sh -->\n- **Warning duplication note:** A skill missing `## Scope` entirely will produce both the existing `missing '## Scope' section` warning AND the new `INVOCATION_CONTRACT: Scope section has 0 unordered bullets` warning. This is expected and correct \u2014 the warnings serve distinct purposes (structural presence vs contract compliance). No deduplication needed during rollout.\n\n## Key context\n\n- Legacy `has_section_header()` and `extract_oos_items()` are currently fence-naive \u2014 making them fence-aware is a correctness fix that prevents false counts from fenced examples\n- Stable `INVOCATION_CONTRACT:` prefix enables T3 to verify per-file compliance via grep\n- Rule #3 presence check is independent of STRICT_REFS resolution check \u2014 both can be enabled/disabled separately\n\n## Acceptance\n- [ ] `has_section_header()`, `extract_oos_items()`, and `extract_scope_items()` ALL fence-aware\n- [ ] `extract_scope_items()`: section-bounded, fence-aware, `- ` only\n- [ ] Rule #3 implemented as dedicated check: OOS bullet `[skill:]` presence, independent of STRICT_REFS\n- [ ] Contract warnings use exact format: `WARN:  <path> -- INVOCATION_CONTRACT: <description>`\n- [ ] Scope: `- ` only; numbered/fenced lines excluded\n- [ ] OOS: `- ` only, fence-aware; `[skill:]` presence fence-aware\n- [ ] Default WARN (exit 0); STRICT_INVOCATION=1 \u2192 ERROR (exit 1) \u2014 toggle verified by exit code\n- [ ] `INVOCATION_CONTRACT_WARN_COUNT` emitted by `_validate_skills.py` (Python)\n- [ ] validate-skills.sh header comments document STRICT_INVOCATION and STRICT_REFS as independent toggles (already done by T1 -- verify presence, do not re-add)\n- [ ] Existing checks still pass (fence-awareness is a correctness improvement, not behavior change for well-formed skills)\n\n## Evidence\n- Commits: 1ec8a8c, bde2242, 9d20213, 57e1e7f, 2995ab5\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh, python3 unit tests for fence-aware functions, STRICT_INVOCATION=1 toggle verification\n- PRs:\n## Done summary\nAdded fence-aware invocation-contract compliance checks to _validate_skills.py: 3 structural rules (Scope bullets, OOS bullets, OOS [skill:] cross-reference presence), STRICT_INVOCATION env var toggle, and INVOCATION_CONTRACT_WARN_COUNT summary key. Made has_section_header(), extract_oos_items(), and new extract_scope_items() all fence-aware for consistency."
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.995424Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.3",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.3.md",
        "status": "todo",
        "title": "Update high-traffic skills with stronger invocation signals",
        "updated_at": "2026-02-20T08:05:23.563586Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.3",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-20T08:45:56.295023Z",
        "evidence": {
          "commits": [
            "fc9c49c",
            "f3fe2a6"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-20T09:00:32.236425Z"
      },
      "spec": "# fn-55-skill-content-invocation-contracts-and.3 Update high-traffic skills with stronger invocation signals\n\n## Description\nUpdate the 14 skills in cases.json corpus with stronger invocation signals per the invocation contract spec. No agents/*.md updates \u2014 deferred to follow-up epic.\n\n**Size:** M\n**Files:** Multiple SKILL.md files (14 skills), `skills/foundation/dotnet-advisor/SKILL.md`\n\n## Approach\n\n- Exact 14 skills from cases.json:\n  1. `dotnet-version-detection` 2. `dotnet-xunit` 3. `dotnet-gha-build-test` 4. `dotnet-minimal-apis`\n  5. `dotnet-architecture-patterns` 6. `dotnet-security-owasp` 7. `dotnet-benchmarkdotnet` 8. `dotnet-blazor-components`\n  9. `dotnet-efcore-patterns` 10. `dotnet-msbuild-authoring` 11. `dotnet-trimming` 12. `dotnet-system-commandline`\n  13. `dotnet-advisor` 14. `dotnet-uno-mcp`\n- Strengthen Scope (\u22651 `- ` bullet) and OOS (\u22651 `- ` bullet with `[skill:name]`)\n- dotnet-advisor: strengthen routing catalog\n- Budget: BUDGET_STATUS != FAIL\n- **No agents/*.md edits** \u2014 agents use a different structure, deferred to follow-up epic\n- No plugin.json changes\n\n## Key context\n\n- T2 emits `INVOCATION_CONTRACT:` stable prefix per warning \u2014 use this for path-scoped verification\n- Most skills have Scope/OOS from fn-53 \u2014 this strengthens existing content\n\n## Acceptance\n- [ ] All 14 skills have \u22651 `- ` bullet in Scope\n- [ ] All 14 skills have \u22651 OOS `- ` bullet with `[skill:name]`\n- [ ] Zero INVOCATION_CONTRACT warnings for the 14 target files \u2014 verifiable:\n  ```\n  ./scripts/validate-skills.sh 2>&1 | grep \"INVOCATION_CONTRACT:\" \\\n    | grep -E \"(dotnet-version-detection|dotnet-xunit|dotnet-gha-build-test|dotnet-minimal-apis|dotnet-architecture-patterns|dotnet-security-owasp|dotnet-benchmarkdotnet|dotnet-blazor-components|dotnet-efcore-patterns|dotnet-msbuild-authoring|dotnet-trimming|dotnet-system-commandline|dotnet-advisor|dotnet-uno-mcp)\" \\\n    | wc -l\n  ```\n  Must output `0`\n- [ ] dotnet-advisor routing catalog strengthened\n- [ ] **No agents/*.md files modified**\n- [ ] `./scripts/validate-skills.sh` passes with 0 errors\n- [ ] `BUDGET_STATUS != FAIL`\n\n## Done summary\nStrengthened invocation signals for all 14 high-traffic skills from cases.json. Added specific Scope bullets reflecting existing body content and OOS bullets with [skill:] cross-references for routing disambiguation. Fixed dotnet-uno-mcp OOS wording per review feedback.\n## Evidence\n- Commits: fc9c49c, f3fe2a6\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:49.095082Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1",
          "fn-55-skill-content-invocation-contracts-and.3"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.4",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.4.md",
        "status": "todo",
        "title": "Add positive and negative control regression test cases",
        "updated_at": "2026-02-20T08:09:32.016969Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.4",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-20T09:06:15.521948Z",
        "evidence": {
          "commits": [
            "602cd71",
            "7b65f7d"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh",
            "./test.sh --self-test --skip-source-setup"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-20T09:24:12.925467Z"
      },
      "spec": "# fn-55-skill-content-invocation-contracts-and.4 Add positive and negative control regression test cases\n\n## Description\nAdd positive/negative control test cases exercising fn-54's schema. Update provider baseline. Prove integration via runner mismatch classifications in output.\n\n**Size:** M\n**Files:** `tests/agent-routing/cases.json`, `tests/agent-routing/provider-baseline.json`, `tests/trigger-corpus.json` (if new categories)\n\n## Approach\n\n- **HARD PREREQUISITE:** fn-54 runner support (optional_skills, disallowed_skills, provider-baseline.json) must be on branch before merge.\n- Add \u22653 positive control cases targeting skills from T3, diverse prompt styles\n- Add \u22652 negative control cases using `disallowed_skills`:\n  - **At least one case MUST be designed to likely trigger the disallowed skill.** The prompt must naturally lead toward the disallowed skill's domain while requiring a different skill for the primary task. This ensures `failure_kind == \"disallowed_hit\"` is actually observable in runner output (not just hypothetical). Set `expected_status` in baseline to reflect the expected outcome per provider.\n- Add \u22651 case with `optional_skills`:\n  - **Prompt must be designed to likely trigger the optional skill** so `optional_hits[]` is populated in runner output. Choose an optional skill whose domain naturally overlaps with the primary task prompt.\n- **Baseline updates:** Run matrix (or `--agents claude,codex,copilot`) to generate baseline entries for all new case IDs. Add entries to `provider-baseline.json` with intended per-provider statuses (claude likely pass, copilot may be fail/infra_error).\n- **Prove integration is active (not hypothetical counterfactual):**\n  - At least one disallowed case produces `disallowed_hit` mismatch classification in runner JSON output when the disallowed skill IS invoked\n  - At least one optional case produces `optional_hits[]` entries in runner JSON output\n  - Verification: `jq '.results[] | select(.failure_kind == \"disallowed_hit\")' <output>` returns non-empty\n  - Verification: `jq '.results[] | select(.optional_hits | length > 0)' <output>` returns non-empty\n- Each case has specific evidence tokens (not copy-pasted defaults)\n- If adding new category, update `tests/trigger-corpus.json`\n\n## Key context\n\n- Current corpus: 14 cases. fn-54 adds optional_skills, disallowed_skills, disallowed_min_tier.\n- fn-54 also adds provider-baseline.json \u2014 new cases MUST have entries or CI will hard-fail\n- All existing cases share generic `required_any_evidence` \u2014 new cases use targeted evidence\n- Memory: \"Trigger corpus completeness\" \u2014 new category \u2192 trigger-corpus.json entry\n- The disallowed case design is critical: if the prompt doesn't naturally lead toward the disallowed skill, the model will simply not invoke it, and `disallowed_hit` will never appear \u2014 making the test case useless for validation\n- **Disallowed cases that produce `disallowed_hit` are expected failures, not bugs.** Their baseline entry should reflect this (e.g., `expected_status: \"fail\"` for providers where the hit is expected). Do NOT conflate \"pass with claude\" with \"all cases succeed.\"\n\n## Acceptance\n- [ ] \u22653 new positive control cases in cases.json\n- [ ] \u22652 new negative control cases using `disallowed_skills`\n- [ ] \u22651 disallowed case with prompt crafted to likely trigger the disallowed skill (observable `disallowed_hit`)\n- [ ] \u22651 case uses `optional_skills` with prompt crafted to likely trigger the optional skill (observable `optional_hits[]`)\n- [ ] `provider-baseline.json` updated with entries for ALL new case IDs per provider\n- [ ] New **positive** cases pass with `--agents claude` locally (with fn-54 on branch)\n- [ ] At least one **disallowed** control case yields `failure_kind == disallowed_hit` in runner output, consistent with `provider-baseline.json` expected_status \u2014 verifiable: `jq` query\n- [ ] At least one **optional** control case yields `optional_hits` entries in runner output \u2014 verifiable: `jq` query\n- [ ] New cases have case-specific evidence tokens\n- [ ] `tests/trigger-corpus.json` updated if new categories added\n\n## Evidence\n- Commits: 602cd71, 7b65f7d\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh, ./test.sh --self-test --skip-source-setup\n- PRs:\n## Done summary\nAdded 6 regression test cases to the agent-routing corpus: 3 positive controls (csharp-async-cancellation, testing-integration-webfactory, observability-structured-logging), 2 disallowed-skill controls (security-hardening-no-blazor-auth, api-endpoints-no-efcore), and 1 optional-skill control (architecture-clean-with-di). All cases use targeted evidence tokens and provider-baseline entries. Disallowed cases use temptation prompts designed to make disallowed_hit observable; optional case prompt forces DI-specific subtask for optional_hits observability."
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:49.194580Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.5",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.5.md",
        "status": "todo",
        "title": "Establish cross-provider change policy and update contributor docs",
        "updated_at": "2026-02-20T08:05:59.410800Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.5",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-20T09:30:17.997019Z",
        "evidence": {
          "commits": [
            "8844bbbf0d4897fd636b7d2708dea83468482387"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-20T09:35:38.296524Z"
      },
      "spec": "# fn-55-skill-content-invocation-contracts-and.5 Establish cross-provider change policy and update contributor docs\n\n## Description\nEstablish cross-provider change policy with an operator-grade checklist in contributor documentation. Policy must be actionable, not ceremonial.\n\n**Size:** S\n**Files:** `CONTRIBUTING.md`, `CONTRIBUTING-SKILLS.md`\n\n## Approach\n\n- Add \"Cross-Provider Change Policy\" subsection to CONTRIBUTING.md near release checklist (lines 234-245)\n- Policy must include 3 concrete operator-grade bullets:\n  1. \"PR description must state: targeted provider (if any) + expected behavior deltas across providers.\"\n  2. \"Attach CI artifact links or paste per-provider summary lines for claude/codex/copilot from CI matrix output.\"\n  3. \"If behavior intentionally diverges between providers, update provider-baseline.json (from fn-54) in same PR with justification comment.\"\n- Add checkbox to release checklist: `- [ ] Cross-provider verification: changes verified against claude/codex/copilot matrix`\n- Add pointer in CONTRIBUTING-SKILLS.md section 5 (\"Testing Your Skill\") to CI provider matrix output for verifying cross-agent behavior\n- Preserve all existing checklist items unchanged\n\n**Shared file note:** T1 also edits `CONTRIBUTING-SKILLS.md` (section 8 checklist item). T5 edits section 5 (testing pointer). These are disjoint sections. T5 depends on T1, ensuring sequential access.\n\n## Key context\n\n- CONTRIBUTING.md release checklist (lines 234-245) uses `- [ ]` checkbox format with backtick-wrapped identifiers\n- CONTRIBUTING-SKILLS.md has \"Testing Your Skill\" section (section 5)\n- T1 edits CONTRIBUTING-SKILLS.md section 8 \u2014 be aware of this when making section 5 edits\n- Memory: \"grep-verifiable ACs\" \u2014 new items must be greppable\n- Policy should reference fn-54's provider-baseline.json for intentional divergence\n\n## Acceptance\n- [ ] `grep \"Cross-Provider\" CONTRIBUTING.md` finds the new policy section\n- [ ] Policy includes 3 concrete bullets (targeted provider, CI artifacts, baseline updates)\n- [ ] Release checklist includes cross-provider verification checkbox item\n- [ ] Policy specifies that provider-targeted changes require explicit non-target verification\n- [ ] CONTRIBUTING-SKILLS.md section 5 references CI provider matrix for testing verification\n- [ ] Existing checklist items preserved unchanged\n\n## Done summary\nAdded Cross-Provider Change Policy section to CONTRIBUTING.md with 3 operator-grade bullets (PR description, CI artifacts, baseline updates) and cross-provider verification checkbox in the release checklist. Added Cross-Provider Verification subsection to CONTRIBUTING-SKILLS.md section 5 with CI provider matrix pointer.\n## Evidence\n- Commits: 8844bbbf0d4897fd636b7d2708dea83468482387\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    }
  ]
}
