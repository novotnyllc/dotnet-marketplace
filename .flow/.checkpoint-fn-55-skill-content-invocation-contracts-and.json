{
  "created_at": "2026-02-19T23:56:03.231661Z",
  "epic": {
    "data": {
      "branch_name": "fn-55-skill-content-invocation-contracts-and",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-19T23:00:27.106168Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [
        "fn-53-skill-routing-language-hardening",
        "fn-54-agent-routing-harness-determinism-and"
      ],
      "id": "fn-55-skill-content-invocation-contracts-and",
      "next_task": 1,
      "plan_review_status": "unknown",
      "plan_reviewed_at": null,
      "spec_path": ".flow/specs/fn-55-skill-content-invocation-contracts-and.md",
      "status": "open",
      "title": "Skill Content Invocation Contracts and Validation",
      "updated_at": "2026-02-19T23:47:52.069446Z"
    },
    "spec": "# Skill Content Invocation Contracts and Validation\n\n## Overview\n\nStrengthen SKILL.md content so invocation signals are explicit, testable, and validated in CI. Define the invocation contract spec, update high-traffic skills, extend the validator with contract compliance checks, add content regression test cases, and establish cross-provider change policy.\n\n**PRD:** `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n**PRD amendment:** Agent updates (agents/*.md) deferred to a follow-up epic. Agents don't use `## Scope`/`## Out of scope` format \u2014 a separate invocation-signal convention for agents is needed before updating them. PRD Workstream B.2 and Acceptance Criteria #6 to be updated with deferral note.\n\n## Scope\n\n- Define invocation contract as purely structural, machine-checkable rules for SKILL.md\n- Update skill-routing-style-guide.md with invocation contract section\n- Update the 14 skills in cases.json corpus with stronger signals\n- Extend _validate_skills.py with structural invocation-contract checks\n- Add positive/negative control test cases (requires fn-54 runner + baseline)\n- Establish cross-provider change policy with operator-grade checklist\n- Fix PRD: epic reference (fn-57 \u2192 fn-55) + agent update deferral note\n\n## Design decisions\n\n- **Invocation contract \u2014 3 structural rules (unordered bullets only):**\n  1. `## Scope` contains \u22651 unordered bullet (`- `) within section boundaries\n  2. `## Out of scope` contains \u22651 unordered bullet (`- `) within section boundaries\n  3. At least one OOS bullet contains a `[skill:<id>]` reference string (presence; resolution governed by STRICT_REFS)\n  - Unordered (`- `) only. Numbered lists do NOT count.\n  - No \"Use when:\" phrasing requirement.\n- **Validation split:** STRICT_INVOCATION (presence) vs STRICT_REFS (resolution) \u2014 independent controls.\n- **STRICT_INVOCATION mechanism:** `_validate_skills.py` reads `STRICT_INVOCATION` env var directly (same pattern as Python-level env reads). When set to `1`, contract warnings become errors. AC proves toggle via exit code difference.\n- **WARN\u2192ERROR rollout:** Default WARN. CI flip after compliance. Rollout playbook in style guide.\n- **Skill scope:** 14 cases.json skills + dotnet-advisor routing catalog. No agents/*.md \u2014 deferred (see PRD amendment).\n- **Test case dependency:** Hard fn-54 prerequisite. Baseline updates required. Integration proved via runner mismatch classifications in JSON output.\n- **Cross-provider policy:** 3 concrete operator-grade bullets.\n- **Budget check:** `BUDGET_STATUS != FAIL` (i.e., `CURRENT_DESC_CHARS < 15600`) \u2014 aligned with validator semantics.\n\n## Task ordering\n\n```\nT1 (contract spec + style guide + PRD fixes) \u2192 T2 (validator checks)\n                                               \u2192 T3 (skill content updates)\nT3 \u2192 T4 (test cases + baseline) [after fn-54 merged + T3 ready]\nT1 \u2192 T5 (cross-provider policy)\n```\n\n## Quick commands\n\n```bash\n./scripts/validate-skills.sh\n./test.sh --agents claude --category foundation,testing\n./scripts/validate-skills.sh 2>&1 | grep BUDGET\n```\n\n## Acceptance\n\n- [ ] Invocation contract in style guide: 3 structural rules, unordered bullets only\n- [ ] Contract separates presence (STRICT_INVOCATION) from resolution (STRICT_REFS)\n- [ ] All 14 cases.json skills have \u22651 Scope `- ` bullet and \u22651 OOS `- ` bullet with `[skill:name]`\n- [ ] Validator: section-bounded, unordered only, WARN default\n- [ ] `STRICT_INVOCATION=1` promotes to ERROR \u2014 toggle proved via exit code AC\n- [ ] `INVOCATION_CONTRACT_WARN_COUNT` in validator output\n- [ ] \u22653 positive, \u22652 disallowed, \u22651 optional cases; baseline updated; integration proved via jq\n- [ ] CONTRIBUTING.md cross-provider policy with 3 operator-grade bullets\n- [ ] PRD: fn-57 \u2192 fn-55 + agent update deferral note\n- [ ] `BUDGET_STATUS != FAIL` (CURRENT_DESC_CHARS < 15600)\n- [ ] All existing validation and tests pass\n\n## References\n\n- PRD: `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n- Predecessor: fn-53; Depends on: fn-54\n- Key files: `docs/skill-routing-style-guide.md`, `scripts/_validate_skills.py`, `tests/agent-routing/cases.json`, `CONTRIBUTING.md`, `CONTRIBUTING-SKILLS.md`\n"
  },
  "epic_id": "fn-55-skill-content-invocation-contracts-and",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.793499Z",
        "depends_on": [],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.1.md",
        "status": "todo",
        "title": "Define invocation contract spec and update style guide",
        "updated_at": "2026-02-19T23:48:22.540897Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.1",
      "runtime": null,
      "spec": "# fn-55-skill-content-invocation-contracts-and.1 Define invocation contract spec and update style guide\n\n## Description\nDefine a purely structural, machine-checkable invocation contract spec for SKILL.md. Document validation split. Include rollout playbook. Fix PRD: epic reference + agent update deferral.\n\n**Size:** M\n**Files:** `docs/skill-routing-style-guide.md`, `CONTRIBUTING-SKILLS.md`, `.flow/specs/prd-routing-reliability-and-skill-invocation.md`\n\n## Approach\n\n- Add \"Invocation Contract\" section to style guide with 3 structural rules:\n  1. Scope contains \u22651 `- ` bullet within section boundaries\n  2. OOS contains \u22651 `- ` bullet within section boundaries\n  3. At least one OOS bullet contains `[skill:<id>]` string (presence only)\n- Unordered (`- `) only. Numbered lists do NOT count. Explicit statement.\n- Validation split: STRICT_INVOCATION (presence) vs STRICT_REFS (resolution) \u2014 documented as independent.\n- No \"Use when:\" phrasing requirement.\n- Positive/negative examples using cases.json skills\n- \"Rollout Playbook\" paragraph: WARN-only \u2192 STRICT_INVOCATION=1 after 130 skills compliant\n- CONTRIBUTING-SKILLS.md section 8 checklist item\n- PRD fixes:\n  - Line 10: `fn-57` \u2192 `fn-55`\n  - Workstream B.2: add note that agent updates (agents/*.md) are deferred \u2014 agents don't use Scope/OOS format, separate convention needed\n  - Acceptance Criteria #6 (if applicable): add deferral note\n\n## Key context\n\n- Style guide already covers description formula, scope format, cross-ref syntax\n- Agent files (agents/*.md) use a different structure than skills \u2014 invocation contract applies to SKILL.md only\n- PRD originally scoped \"skill and agent updates\" but agents need a different convention first\n\n## Acceptance\n- [ ] `grep \"Invocation Contract\" docs/skill-routing-style-guide.md` finds section\n- [ ] 3 structural rules, unordered bullets only, numbered lists excluded\n- [ ] STRICT_INVOCATION vs STRICT_REFS split documented\n- [ ] NO \"Use when:\" requirement stated\n- [ ] Examples included\n- [ ] Rollout playbook paragraph\n- [ ] CONTRIBUTING-SKILLS.md checklist item\n- [ ] PRD: fn-57 \u2192 fn-55 corrected\n- [ ] PRD: Workstream B.2 agent deferral note added\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.893677Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.2.md",
        "status": "todo",
        "title": "Add invocation-contract compliance checks to validator",
        "updated_at": "2026-02-19T23:53:48.007423Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.2",
      "runtime": null,
      "spec": "# fn-55-skill-content-invocation-contracts-and.2 Add invocation-contract compliance checks to validator\n\n## Description\nAdd structural invocation-contract checks with fence-aware section extraction (applied to all section checks for consistency), stable grep-friendly markers, and STRICT_INVOCATION toggle.\n\n**Size:** M\n**Files:** `scripts/_validate_skills.py`, `scripts/validate-skills.sh`\n\n## Approach\n\n- **Fence-awareness for ALL section checks:** Make `has_section_header()`, `extract_oos_items()`, and new `extract_scope_items()` all fence-aware. Same `in_fence` toggle (lines starting with ```) applied consistently. This ensures all scope/OOS-related checks agree on what \"real markdown structure\" means \u2014 no contradictory output.\n- Add `extract_scope_items(content)`: section-bounded (enter `^## Scope$`, exit next `^## `), fence-aware, `- ` only\n- Contract checks (all fence-aware):\n  1. Scope \u22651 `- ` bullet\n  2. OOS \u22651 `- ` bullet\n  3. OOS contains \u22651 `[skill:<id>]` string\n- **Stable grep marker:** Contract warnings use `INVOCATION_CONTRACT:` prefix in warning line for path-scoped filtering:\n  `skills/<cat>/<name>/SKILL.md: INVOCATION_CONTRACT: Scope section has 0 unordered bullets (requires \u22651)`\n- STRICT_INVOCATION mechanism: `_validate_skills.py` reads env var. Truthy \u2192 contract warnings become errors.\n- Default WARN (exit 0); STRICT_INVOCATION=1 \u2192 ERROR (exit 1)\n- `INVOCATION_CONTRACT_WARN_COUNT=<N>` in validate-skills.sh output\n\n## Key context\n\n- Legacy `has_section_header()` and `extract_oos_items()` are currently fence-naive \u2014 making them fence-aware is a correctness fix that prevents false counts from fenced examples\n- Stable `INVOCATION_CONTRACT:` prefix enables T3 to verify per-file compliance via grep\n\n## Acceptance\n- [ ] `has_section_header()`, `extract_oos_items()`, and `extract_scope_items()` ALL fence-aware\n- [ ] `extract_scope_items()`: section-bounded, fence-aware, `- ` only\n- [ ] Contract warnings use `INVOCATION_CONTRACT:` stable prefix \u2014 verifiable: grep output\n- [ ] Scope: `- ` only; numbered/fenced lines excluded\n- [ ] OOS: `- ` only, fence-aware; `[skill:]` presence fence-aware\n- [ ] Default WARN (exit 0); STRICT_INVOCATION=1 \u2192 ERROR (exit 1) \u2014 toggle verified by exit code\n- [ ] `INVOCATION_CONTRACT_WARN_COUNT` in output\n- [ ] Existing checks still pass (fence-awareness is a correctness improvement, not behavior change for well-formed skills)\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:48.995424Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.3",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.3.md",
        "status": "todo",
        "title": "Update high-traffic skills and agents with stronger invocation signals",
        "updated_at": "2026-02-19T23:53:48.118266Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.3",
      "runtime": null,
      "spec": "# fn-55-skill-content-invocation-contracts-and.3 Update high-traffic skills with stronger invocation signals\n\n## Description\nUpdate the 14 skills in cases.json corpus with stronger invocation signals per the invocation contract spec.\n\n**Size:** M\n**Files:** Multiple SKILL.md files (14 skills), `skills/foundation/dotnet-advisor/SKILL.md`\n\n## Approach\n\n- Exact 14 skills from cases.json:\n  1. `dotnet-version-detection` 2. `dotnet-xunit` 3. `dotnet-gha-build-test` 4. `dotnet-minimal-apis`\n  5. `dotnet-architecture-patterns` 6. `dotnet-security-owasp` 7. `dotnet-benchmarkdotnet` 8. `dotnet-blazor-components`\n  9. `dotnet-efcore-patterns` 10. `dotnet-msbuild-authoring` 11. `dotnet-trimming` 12. `dotnet-system-commandline`\n  13. `dotnet-advisor` 14. `dotnet-uno-mcp`\n- Strengthen Scope (\u22651 `- ` bullet) and OOS (\u22651 `- ` bullet with `[skill:name]`)\n- dotnet-advisor: strengthen routing catalog\n- Budget: BUDGET_STATUS != FAIL\n- No agents/*.md, no plugin.json\n\n## Key context\n\n- T2 emits `INVOCATION_CONTRACT:` stable prefix per warning \u2014 use this for path-scoped verification\n- Most skills have Scope/OOS from fn-53 \u2014 this strengthens existing content\n\n## Acceptance\n- [ ] All 14 skills have \u22651 `- ` bullet in Scope\n- [ ] All 14 skills have \u22651 OOS `- ` bullet with `[skill:name]`\n- [ ] Zero INVOCATION_CONTRACT warnings for the 14 target files \u2014 verifiable:\n  ```\n  ./scripts/validate-skills.sh 2>&1 | grep \"INVOCATION_CONTRACT:\" \\\n    | grep -E \"(dotnet-version-detection|dotnet-xunit|dotnet-gha-build-test|dotnet-minimal-apis|dotnet-architecture-patterns|dotnet-security-owasp|dotnet-benchmarkdotnet|dotnet-blazor-components|dotnet-efcore-patterns|dotnet-msbuild-authoring|dotnet-trimming|dotnet-system-commandline|dotnet-advisor|dotnet-uno-mcp)\" \\\n    | wc -l\n  ```\n  Must output `0`\n- [ ] dotnet-advisor routing catalog strengthened\n- [ ] `./scripts/validate-skills.sh` passes with 0 errors\n- [ ] `BUDGET_STATUS != FAIL`\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:49.095082Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1",
          "fn-55-skill-content-invocation-contracts-and.3"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.4",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.4.md",
        "status": "todo",
        "title": "Add positive and negative control regression test cases",
        "updated_at": "2026-02-19T23:45:04.628676Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.4",
      "runtime": null,
      "spec": "# fn-55-skill-content-invocation-contracts-and.4 Add positive and negative control regression test cases\n\n## Description\nAdd positive/negative control test cases exercising fn-54's schema. Update provider baseline. Prove integration via runner mismatch classifications in output.\n\n**Size:** M\n**Files:** `tests/agent-routing/cases.json`, `tests/agent-routing/provider-baseline.json`, `tests/trigger-corpus.json` (if new categories)\n\n## Approach\n\n- **HARD PREREQUISITE:** fn-54 runner support (optional_skills, disallowed_skills, provider-baseline.json) must be on branch before merge.\n- Add \u22653 positive control cases targeting skills from T3, diverse prompt styles\n- Add \u22652 negative control cases using `disallowed_skills` \u2014 prompts that should NOT invoke specific skills\n- Add \u22651 case with `optional_skills` for diagnostic output\n- **Baseline updates:** Run matrix (or `--agents claude,codex,copilot`) to generate baseline entries for all new case IDs. Add entries to `provider-baseline.json` with intended per-provider statuses (claude likely pass, copilot may be fail/infra_error).\n- **Prove integration is active (not hypothetical counterfactual):**\n  - At least one disallowed case must produce `disallowed_hit` mismatch classification in runner JSON output when the disallowed skill IS invoked\n  - At least one optional case must produce `optional_hits[]` entries in runner JSON output\n  - Verification: `jq '.results[] | select(.failure_kind == \"disallowed_hit\")' <output>` returns non-empty\n- Each case has specific evidence tokens (not copy-pasted defaults)\n- If adding new category, update `tests/trigger-corpus.json`\n\n## Key context\n\n- Current corpus: 14 cases. fn-54 adds optional_skills, disallowed_skills, disallowed_min_tier.\n- fn-54 also adds provider-baseline.json \u2014 new cases MUST have entries or CI will hard-fail\n- All existing cases share generic `required_any_evidence` \u2014 new cases use targeted evidence\n- Memory: \"Trigger corpus completeness\" \u2014 new category \u2192 trigger-corpus.json entry\n\n## Acceptance\n- [ ] \u22653 new positive control cases in cases.json\n- [ ] \u22652 new negative control cases using `disallowed_skills`\n- [ ] \u22651 case uses `optional_skills`\n- [ ] `provider-baseline.json` updated with entries for ALL new case IDs per provider\n- [ ] Runner JSON output includes `disallowed_hit` classification for at least one case \u2014 verifiable: `jq` query\n- [ ] Runner JSON output includes `optional_hits` for at least one case \u2014 verifiable: `jq` query\n- [ ] New cases have case-specific evidence tokens\n- [ ] All new cases pass with `--agents claude` locally (with fn-54 on branch)\n- [ ] `tests/trigger-corpus.json` updated if new categories added\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-19T23:01:49.194580Z",
        "depends_on": [
          "fn-55-skill-content-invocation-contracts-and.1"
        ],
        "epic": "fn-55-skill-content-invocation-contracts-and",
        "id": "fn-55-skill-content-invocation-contracts-and.5",
        "priority": null,
        "spec_path": ".flow/tasks/fn-55-skill-content-invocation-contracts-and.5.md",
        "status": "todo",
        "title": "Establish cross-provider change policy and update contributor docs",
        "updated_at": "2026-02-19T23:40:45.060687Z"
      },
      "id": "fn-55-skill-content-invocation-contracts-and.5",
      "runtime": null,
      "spec": "# fn-55-skill-content-invocation-contracts-and.5 Establish cross-provider change policy and update contributor docs\n\n## Description\nEstablish cross-provider change policy with an operator-grade checklist in contributor documentation. Policy must be actionable, not ceremonial.\n\n**Size:** S\n**Files:** `CONTRIBUTING.md`, `CONTRIBUTING-SKILLS.md`\n\n## Approach\n\n- Add \"Cross-Provider Change Policy\" subsection to CONTRIBUTING.md near release checklist (lines 234-245)\n- Policy must include 3 concrete operator-grade bullets:\n  1. \"PR description must state: targeted provider (if any) + expected behavior deltas across providers.\"\n  2. \"Attach CI artifact links or paste per-provider summary lines for claude/codex/copilot from CI matrix output.\"\n  3. \"If behavior intentionally diverges between providers, update provider-baseline.json (from fn-54) in same PR with justification comment.\"\n- Add checkbox to release checklist: `- [ ] Cross-provider verification: changes verified against claude/codex/copilot matrix`\n- Add pointer in CONTRIBUTING-SKILLS.md section 5 (\"Testing Your Skill\") to CI provider matrix output for verifying cross-agent behavior\n- Preserve all existing checklist items unchanged\n\n## Key context\n\n- CONTRIBUTING.md release checklist (lines 234-245) uses `- [ ]` checkbox format with backtick-wrapped identifiers\n- CONTRIBUTING-SKILLS.md has \"Testing Your Skill\" section (section 5)\n- Memory: \"grep-verifiable ACs\" \u2014 new items must be greppable\n- Policy should reference fn-54's provider-baseline.json for intentional divergence\n\n## Acceptance\n- [ ] `grep \"Cross-Provider\" CONTRIBUTING.md` finds the new policy section\n- [ ] Policy includes 3 concrete bullets (targeted provider, CI artifacts, baseline updates)\n- [ ] Release checklist includes cross-provider verification checkbox item\n- [ ] Policy specifies that provider-targeted changes require explicit non-target verification\n- [ ] CONTRIBUTING-SKILLS.md references CI provider matrix for testing verification\n- [ ] Existing checklist items preserved unchanged\n"
    }
  ]
}
