{
  "created_at": "2026-02-21T03:47:10.008953Z",
  "epic": {
    "data": {
      "branch_name": "fn-56-copilot-structural-compatibility",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-21T00:03:13.475656Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [],
      "id": "fn-56-copilot-structural-compatibility",
      "next_task": 1,
      "plan_review_status": "ship",
      "plan_reviewed_at": "2026-02-21T01:11:56.290916Z",
      "spec_path": ".flow/specs/fn-56-copilot-structural-compatibility.md",
      "status": "open",
      "title": "Copilot Structural Compatibility",
      "updated_at": "2026-02-21T01:11:56.291470Z"
    },
    "spec": "# Copilot Structural Compatibility\n\n## Overview\n\nMake dotnet-artisan's skill directory layout, YAML frontmatter, and validators compatible with GitHub Copilot CLI and VS Code Copilot Chat, while preserving full Claude Code and Codex functionality.\n\n**Problem:** Copilot discovers skills by scanning one level deep under `skills/`. The current nested layout (`skills/<category>/<skill-name>/SKILL.md`) causes Copilot to interpret category directories as skill names, finding zero actual skills. Additionally, YAML frontmatter quirks (quoted descriptions, missing `license:` field) cause silent load failures in Copilot CLI.\n\n**Constraint \u2014 32-skill display limit:** Copilot CLI has a hard ~32 skill display limit in the system prompt (issues #1464, #1130). **Unverified assumption:** whether `user-invocable: false` skills (120 of 131) are excluded from this budget. With only 11 user-invocable skills, the limit may be a non-issue. This must be verified before designing a routing strategy.\n\n## Research Sources\n\n- **VS Code Copilot Chat source** (`microsoft/vscode-copilot-chat`): `relativePath.split('/')[0]` confirms one-level-deep scanning\n- **Copilot CLI changelog**: v0.0.413 did NOT change nested directory behavior; only fixed YAML array `allowed-tools`\n- **Copilot CLI v0.0.412**: Added `disable-model-invocation` and `user-invocable: false` support\n- **Agent Skills spec** (`agentskills.io/specification`): Defines flat `skill-name/SKILL.md` layout; all reference repos use flat\n- **Copilot CLI issues**: #1464 (32-skill limit), #894 (license required), #1024 (quoted descriptions fail), #951 (metadata last field), #1021 (symlinks ignored)\n- **dotnet-skills-evals**: DSPy eval framework; compressed-index discovery mechanism tested at 56.5% TPR\n- **dotnet-skills issue #48**: Progressive disclosure for skills >500 lines\n- **Existing work on `copilot-refactor` branch**: Smoke runners, baseline JSONs, validator updates already committed\n- **Skill invocability breakdown**: 11 user-invocable, 120 non-user-invocable (`user-invocable: false`)\n\n## Scope\n\n- Flatten `skills/<category>/<skill-name>/` to `skills/<skill-name>/` (131 directories)\n- Update all entries in `.claude-plugin/plugin.json:skills[]` to flat paths\n- Migrate all 131 SKILL.md frontmatter for Copilot safety\n- Update validators (including similarity detection), baselines, and depth-sensitive scripts\n- Verify 32-skill limit behavior with `user-invocable: false`; design routing strategy accordingly\n- Update all documentation referencing the nested layout (including behavioral changes: quoting guidance, similarity scoring)\n\n## Out of scope\n\n- Copilot Extensions/Skillsets API (different feature from Agent Skills)\n- Changes to hook scripts or MCP server configuration (Copilot handles these differently; addressed if testing reveals issues)\n- Copilot CLI installation/distribution (users install separately)\n\n## Approach\n\n1. **Atomic flatten** in a single commit using `git mv` to preserve history. Preflight collision check before any moves.\n2. **Frontmatter migration** scripted across all 131 SKILL.md files (raw-line inspection for quoting, not post-parse)\n3. **Validator updates** additive \u2014 T2 owns all raw-frontmatter Copilot safety checks (BOM, quoted desc, license, metadata ordering) as ERRORs; T3 owns layout guard + similarity detector (glob fix, remove same-category boost, remove category fields)\n4. **32-skill strategy**: First verify whether `user-invocable: false` skills count against the limit. If only 11 user-invocable skills count -> limit is a non-issue, just ensure advisor visibility. If all 131 count -> design advisor meta-router fallback.\n5. **Documentation** updated in a dedicated pass after structural changes stabilize. Covers path rewrites AND behavioral changes (quoting guidance, similarity scoring). Intermediate commits on the branch may fail CI; PR must be green.\n\n## Canonical skill count\n\n**131 skills.** All specs, scripts (`validate-skills.sh --projected-skills`), docs (AGENTS.md, README.md), and `.agents/openai.yaml` must use this number consistently. Use `jq '.skills|length' .claude-plugin/plugin.json` to verify.\n\n## Risks\n\n- **plugin.json + filesystem inconsistency** causes all Claude Code skill loading to fail -> mitigated by atomic commit\n- **Codex sync breaks** due to `find -mindepth 2` in `test.sh` -> explicit fix in flatten task, with SKILL.md existence check\n- **Description unquoting** may break YAML for descriptions with special characters -> scripted with raw-line validation\n- **Baseline invalidation** across routing-warnings and similarity baselines -> regenerated in validator task\n- **Similarity validator `*/*/SKILL.md` glob** finds zero skills after flatten -> fixed in T3\n- **Copilot CLI auth in CI** may require token/secrets configuration -> documented in fn-57.4\n- **metadata-last field semantics ambiguous** (bug #951) -> T2 verifies exact behavior with test skills before implementing the check; falls back to conservative \"ERROR if metadata is last key\" if CLI unavailable\n\n## Quick commands\n\n```bash\n# Preflight collision check (run BEFORE flatten)\nfind skills -name SKILL.md -mindepth 3 -maxdepth 3 | xargs -I{} dirname {} | xargs -I{} basename {} | sort | uniq -d\n\n# Verify flat layout (no nested SKILL.md)\nfor dir in skills/*/*/; do [[ -f \"${dir}SKILL.md\" ]] && echo \"NESTED: $dir\"; done\n\n# Verify skill count preserved\nfind skills -name SKILL.md -maxdepth 2 | wc -l  # should be 131\n\n# Verify plugin.json paths resolve\njq -r '.skills[]' .claude-plugin/plugin.json | while read p; do [[ -f \"${p}/SKILL.md\" ]] || echo \"MISSING: $p\"; done\n\n# Run validators\n./scripts/validate-skills.sh && ./scripts/validate-marketplace.sh\n```\n\n## Acceptance\n\n- [ ] All 131 skills exist at `skills/<skill-name>/SKILL.md` (flat, one level deep)\n- [ ] No `skills/<category>/<skill-name>/SKILL.md` paths remain (no nested skills)\n- [ ] `plugin.json` skill paths all resolve to existing directories with SKILL.md (`jq '.skills|length'` matches find count)\n- [ ] All 131 SKILL.md files have `license: MIT` in frontmatter and unquoted descriptions\n- [ ] `./scripts/validate-skills.sh && ./scripts/validate-marketplace.sh` pass (including similarity)\n- [ ] 32-skill limit behavior verified with `user-invocable: false` skills\n- [ ] Routing strategy implemented based on verified behavior\n- [ ] AGENTS.md, CONTRIBUTING.md, CONTRIBUTING-SKILLS.md, README.md updated for flat layout AND behavioral changes\n- [ ] Git history preserved for all moved files (git mv, not delete+create)\n- [ ] Canonical skill count (131) consistent across all specs, scripts, and docs\n\n## Dependencies\n\n- Builds on fn-42 (directory structure), fn-51 (frontmatter), fn-54 (test harness), fn-55 (validator)\n- All predecessors are done/merged; no open blockers\n- Epic fn-57 (testing) depends on this epic completing first\n\n## References\n\n- VS Code Copilot Chat: `src/platform/customInstructions/common/customInstructionsService.ts`\n- Agent Skills spec: https://agentskills.io/specification\n- Copilot CLI: https://github.com/github/copilot-cli/\n- Issue #48: https://github.com/Aaronontheweb/dotnet-skills/issues/48\n- dotnet-skills-evals: https://github.com/Aaronontheweb/dotnet-skills-evals\n- microsoft/skills: https://github.com/microsoft/skills (flat layout reference)\n"
  },
  "epic_id": "fn-56-copilot-structural-compatibility",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-21T00:04:30.307316Z",
        "depends_on": [],
        "epic": "fn-56-copilot-structural-compatibility",
        "id": "fn-56-copilot-structural-compatibility.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-56-copilot-structural-compatibility.1.md",
        "status": "in_progress",
        "title": "Atomic flatten of skills directory",
        "updated_at": "2026-02-21T00:47:44.076942Z"
      },
      "id": "fn-56-copilot-structural-compatibility.1",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-21T01:19:19.786287Z",
        "evidence": {
          "commits": [
            "dbf4f75453694c080b6419c9d4e64c33e601fd8a"
          ],
          "tests": [
            "find skills -name SKILL.md -maxdepth 2 | wc -l (131)",
            "jq .skills|length plugin.json (131)",
            "git log --follow for 3 sampled skills",
            "plugin.json path resolution check (0 missing)"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-21T01:40:03.974075Z"
      },
      "spec": "# fn-56-copilot-structural-compatibility.1 Atomic flatten of skills directory\n\n## Description\n\nMove all 131 skill directories from `skills/<category>/<skill-name>/` to `skills/<skill-name>/` in a single atomic commit. Update all path references that depend on the nested layout.\n\n**Size:** M\n**Files:** skills/ (131 directories moved), .claude-plugin/plugin.json (all entries in `skills[]`), test.sh (find depth), .agents/openai.yaml (default_prompt path pattern), scripts/validate-skills.sh (projected count)\n\n## Approach\n\n1. **Preflight collision check**: Build a map of `<skill-name> -> source paths`. Hard-fail if any duplicate skill names exist across categories before running any `git mv`. (Currently all 131 names are unique, but this guard prevents silent overwrites.)\n\n2. **Flatten via `git mv`**: Write a shell script that iterates all `skills/<category>/<skill-name>/` directories and runs `git mv` for each to `skills/<skill-name>/` \u2014 preserves git history.\n\n3. **Update all entries in `.claude-plugin/plugin.json`** `skills` array from `./skills/<category>/<skill-name>` to `./skills/<skill-name>`. Verify count with `jq '.skills|length'`.\n\n4. **Fix `test.sh` Codex sync**: Change `find \"$REPO_ROOT/skills\" -mindepth 2 -maxdepth 2 -type d` to `-mindepth 1 -maxdepth 1 -type d`. Additionally, add a `SKILL.md` existence check inside each found directory to avoid syncing non-skill directories.\n\n5. **Update `.agents/openai.yaml`** \u2014 change `skills/<category>/<skill-name>/` to `skills/<skill-name>/` in both `default_prompt` and `short_description`. Update skill count to 131 in both fields.\n\n6. **Update `scripts/validate-skills.sh`** \u2014 change `--projected-skills 130` to `--projected-skills 131`.\n\n7. **Remove empty category directories** (25 dirs including `containers/`, `data-access/`).\n\n8. **Preserve companion files**: `details.md` (2 skills), `reference/` (windbg - 16 files), `scripts/` (version-detection). `git mv` of the parent directory handles this automatically.\n\n9. **Verify skill count preserved**: `find skills -name SKILL.md -maxdepth 2 | wc -l` must equal 131.\n\n10. All operations in a single commit.\n\n## Key context\n\n- `_validate_skills.py` `skills_dir.rglob(\"SKILL.md\")` finds skills at any depth \u2014 works after flatten\n- `_validate_skills.py` extracts IDs from `f.parent.name` (directory name only) \u2014 no change needed\n- `validate-similarity.py` `collect_skill_descriptions()` uses `glob(\"*/*/SKILL.md\")` \u2014 finds ZERO skills after flatten. Fixed in T3, not here.\n- `test.sh` Codex sync `find` command with `-mindepth 2 -maxdepth 2` is the primary depth-sensitive command\n- Intermediate commits may fail CI (similarity validator breaks until T3 lands) \u2014 this is expected; the PR must be green at the end\n\n## Acceptance\n- [ ] Preflight collision check runs and passes (no duplicate skill names)\n- [ ] All 131 skills exist at `skills/<skill-name>/SKILL.md` (one level deep)\n- [ ] No `skills/<category>/<skill-name>/SKILL.md` paths remain\n- [ ] No empty category directories remain under `skills/`\n- [ ] All `plugin.json` skill paths updated to `./skills/<skill-name>` format (verified via `jq '.skills|length'`)\n- [ ] `test.sh` find command uses `-mindepth 1 -maxdepth 1` with SKILL.md existence check\n- [ ] `.agents/openai.yaml` `default_prompt` and `short_description` both reflect 131 + flat layout\n- [ ] `scripts/validate-skills.sh` uses `--projected-skills 131`\n- [ ] Companion files (details.md, reference/, scripts/) preserved with their skills\n- [ ] `git log --follow` works for at least 3 sampled skill files (history preserved)\n- [ ] Skill count: `find skills -name SKILL.md -maxdepth 2 | wc -l` equals 131\n- [ ] Single commit containing all changes\n\n## Done summary\nFlattened all 131 skill directories from skills/<category>/<skill-name>/ to skills/<skill-name>/ via git mv. Updated plugin.json paths, test.sh find depth, openai.yaml layout/count, and validate-skills.sh projected count. Removed empty category directories.\n## Evidence\n- Commits: dbf4f75453694c080b6419c9d4e64c33e601fd8a\n- Tests: find skills -name SKILL.md -maxdepth 2 | wc -l (131), jq .skills|length plugin.json (131), git log --follow for 3 sampled skills, plugin.json path resolution check (0 missing)\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-21T00:04:30.442328Z",
        "depends_on": [
          "fn-56-copilot-structural-compatibility.1"
        ],
        "epic": "fn-56-copilot-structural-compatibility",
        "id": "fn-56-copilot-structural-compatibility.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-56-copilot-structural-compatibility.2.md",
        "status": "todo",
        "title": "Copilot-safe frontmatter migration",
        "updated_at": "2026-02-21T01:12:13.834477Z"
      },
      "id": "fn-56-copilot-structural-compatibility.2",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-21T01:42:42.248941Z",
        "evidence": {
          "commits": [
            "19c0670be27d00b37dca0413a61b2e01b4e2ae3c",
            "6b8694a2903e058103f6d53fc9e2f44a4b1a2e41"
          ],
          "prs": [],
          "tests": [
            "python3 scripts/_validate_skills.py --repo-root . --projected-skills 131 --max-desc-chars 120 --warn-threshold 12000 --fail-threshold 15600 --allow-planned-refs"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-21T02:00:44.761687Z"
      },
      "spec": "# fn-56-copilot-structural-compatibility.2 Copilot-safe frontmatter migration\n\n## Description\n\nMigrate all 131 SKILL.md frontmatter files to be Copilot-safe. Address known Copilot CLI YAML parsing bugs that cause silent skill load failures. This task owns ALL frontmatter validation changes in `_validate_skills.py`.\n\n**Size:** M\n**Files:** skills/*/SKILL.md (131 files), scripts/_validate_skills.py (ALLOWED_FRONTMATTER_FIELDS, FIELD_TYPES, raw-frontmatter checks)\n\n## Approach\n\n1. **Verify metadata-last behavior** (FIRST, before implementing the check): Copilot bug #951 reports that `metadata:` as the last frontmatter field causes silent skill drop, but the exact semantics are ambiguous. Create two minimal test skills in a temp directory:\n   - `test-meta-last/SKILL.md` \u2014 frontmatter with `metadata:` as the literal last YAML key\n   - `test-meta-notlast/SKILL.md` \u2014 same frontmatter but with a dummy field after `metadata:`\n   Minimal repro procedure (from `test.sh:prepare_copilot_plugin()`):\n   - Create a temp directory with the minimum plugin structure Copilot requires:\n     ```\n     /tmp/test-meta-dir/\n       .claude-plugin/\n         plugin.json          # {\"name\":\"test-meta\",\"skills\":[\"./skills/test-meta-last\",\"./skills/test-meta-notlast\"]}\n         marketplace.json     # {\"name\":\"test-meta\",\"version\":\"0.0.1\"}\n       skills/\n         test-meta-last/SKILL.md\n         test-meta-notlast/SKILL.md\n     ```\n     Base these files on the repo's actual `.claude-plugin/plugin.json` and `marketplace.json` schema (copy and trim to 2 skills) so the only variable is metadata ordering.\n   - `copilot plugin marketplace add /tmp/test-meta-dir`\n   - `copilot plugin install test-meta@test-meta`\n   - `copilot plugin marketplace list` \u2014 verify plugin appears\n   - Test which skill(s) load and which silently drop\n   - Record the exact commands and observed output as evidence\n   Use the confirmed behavior to define the exact check logic in step 4. If Copilot CLI is unavailable, implement the check conservatively (ERROR if `metadata:` is last key) and document the assumption.\n\n2. **Add `license: MIT` field** to all 131 SKILL.md files \u2014 Copilot bug #894 effectively requires this field. Add after `description:` and before any optional fields.\n\n3. **Unquote description values** \u2014 Copilot bug #1024 breaks on `description: \"quoted text\"`. Remove surrounding double quotes from all description values. This includes `dotnet-advisor` and all other skills. Use **raw-line inspection** (not YAML parse) to detect quoting, since parsed YAML loses quote information.\n   - Verify no description starts with YAML special characters (`{`, `[`, `*`, `&`, `!`, `%`, `@`, `` ` ``) after unquoting.\n   - Verify no description contains mid-string YAML-unsafe patterns (`: ` followed by a value, ` #` interpreted as comment, leading `?`). If any exist, rewrite the description to avoid the hazard (e.g., rephrase or use different punctuation).\n   - Single-quoted `dotnet-gha-patterns` also needs unquoting.\n   - **YAML round-trip verification**: After unquoting, the migration script must parse each modified SKILL.md with Python `yaml.safe_load()` and verify the description value matches the intended plain text. This catches any case where unquoting introduced a parse error or altered the value. Use `python3 -m pip install --user pyyaml` for the migration script (one-off dependency, not committed to repo requirements).\n\n4. **Add raw-frontmatter Copilot safety checks to `_validate_skills.py`** (in `process_file()`, before/alongside YAML parsing):\n   - **BOM check**: `content.startswith(\"\\ufeff\")` \u2192 ERROR\n   - **Quoted description**: regex for `description:\\s*[\"']` on raw line \u2192 ERROR\n   - **Missing license**: `license` not in parsed frontmatter \u2192 ERROR\n   - **metadata ordering**: Enforce the invariant verified in step 1 \u2192 ERROR. Exact check logic derived from experiment evidence.\n\n5. **Add `license` to both `ALLOWED_FRONTMATTER_FIELDS` and `FIELD_TYPES`** in `_validate_skills.py`. Set type to `str`.\n\n6. Write a migration script (temporary, not committed) that processes all 131 files.\n\n## Key context\n\n- **Sequential dependency**: This task and T3 both edit `_validate_skills.py`. They must NOT run in parallel \u2014 changes must be rebased/merged sequentially (T2 first, then T3).\n- All 131 skills currently use `description: \"...\"` (double-quoted). Copilot CLI #1024 fails on quoted descriptions.\n- `_validate_skills.py` parses YAML and loses quoting info \u2014 raw-line checks are needed alongside the YAML parse\n- The `EXTRA_FIELD_COUNT` baseline in `routing-warnings-baseline.json` will NOT be affected because `license` will be in the allowed set\n- This task is the sole owner of all Copilot frontmatter checks in `_validate_skills.py` \u2014 T3 does NOT add frontmatter checks (only layout guard + similarity)\n- After T1 flatten, `validate-similarity.py` will find zero skills until T3 fixes its glob \u2014 so this task validates with `_validate_skills.py` directly, not the full `validate-skills.sh`\n\n## Done summary\nMigrated all 131 SKILL.md files to Copilot-safe frontmatter: unquoted descriptions (13 rewritten to avoid YAML-unsafe `: ` patterns), added `license: MIT` to all skills, and added raw-frontmatter Copilot safety checks (BOM, quoted description, missing license, metadata-last ordering) as ERRORs in `_validate_skills.py`.\n## Evidence\n- Commits: 19c0670be27d00b37dca0413a61b2e01b4e2ae3c, 6b8694a2903e058103f6d53fc9e2f44a4b1a2e41\n- Tests: python3 scripts/_validate_skills.py --repo-root . --projected-skills 131 --max-desc-chars 120 --warn-threshold 12000 --fail-threshold 15600 --allow-planned-refs\n- PRs:\n## Acceptance\n- [ ] metadata-ordering behavior verified with Copilot CLI test skills; exact command and observed output recorded as evidence (or conservative assumption documented if CLI unavailable)\n- [ ] Validator enforces the verified metadata-ordering invariant as an ERROR\n- [ ] All 131 SKILL.md files contain `license: MIT` in frontmatter\n- [ ] No SKILL.md file has double-quoted or single-quoted `description:` value (verified by raw-line inspection)\n- [ ] No SKILL.md file starts with UTF-8 BOM\n- [ ] `license` added to both `ALLOWED_FRONTMATTER_FIELDS` and `FIELD_TYPES` in `_validate_skills.py`\n- [ ] Raw-frontmatter Copilot safety checks added to validator as ERRORs (BOM, quoted description, missing license, metadata ordering)\n- [ ] Frontmatter-only validation passes (before T3 similarity fix): `python3 scripts/_validate_skills.py --repo-root . --projected-skills 131 --max-desc-chars 120 --warn-threshold 12000 --fail-threshold 15600 --allow-planned-refs`\n- [ ] Full `./scripts/validate-skills.sh` passes after T3 lands\n- [ ] Spot-check 5 descriptions containing colons parse correctly with Python yaml\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-21T00:04:30.601907Z",
        "depends_on": [
          "fn-56-copilot-structural-compatibility.1",
          "fn-56-copilot-structural-compatibility.2"
        ],
        "epic": "fn-56-copilot-structural-compatibility",
        "id": "fn-56-copilot-structural-compatibility.3",
        "priority": null,
        "spec_path": ".flow/tasks/fn-56-copilot-structural-compatibility.3.md",
        "status": "todo",
        "title": "Update validators and baselines for flat layout",
        "updated_at": "2026-02-21T01:09:03.649867Z"
      },
      "id": "fn-56-copilot-structural-compatibility.3",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-21T02:15:31.585598Z",
        "evidence": {
          "commits": [
            "b585e0a0f7abc306ba6d57e904ca1c1656b27393"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-21T02:28:22.723512Z"
      },
      "spec": "# fn-56-copilot-structural-compatibility.3 Update validators and baselines for flat layout\n\n## Description\n\nUpdate layout-dependent validation scripts (similarity detector, marketplace validator) and regenerate all baselines for the flat directory structure. This task does NOT add frontmatter checks (owned by T2).\n\n**Size:** M\n**Files:** scripts/validate-similarity.py, scripts/similarity-baseline.json, scripts/routing-warnings-baseline.json, scripts/validate-marketplace.sh, scripts/_validate_skills.py (layout guard only)\n\n## Approach\n\n1. **Fix `validate-similarity.py` glob** (CRITICAL): `collect_skill_descriptions()` uses `skills_dir.glob(\"*/*/SKILL.md\")` which finds ZERO skills after flatten. Change to `skills_dir.glob(\"*/SKILL.md\")`. Also fix `category = skill_md.parent.parent.name` which would become `\"skills\"` for every skill \u2014 remove the `category` and `same_category` fields from the report entirely since categories no longer exist in the flat layout. This avoids misleading noise in baselines.\n\n2. **Remove same-category boost**: The `+0.15` boost for skills in the same parent directory is meaningless after flatten (all skills share parent `skills/`). Remove it entirely \u2014 simpler and avoids false positive grouping.\n\n3. **Add flat layout guard to `_validate_skills.py`**: ERROR if any SKILL.md is found more than 1 level deep under `skills/` (catches accidental re-nesting). This is the ONLY change to `_validate_skills.py` in this task.\n\n4. **Verify `validate-marketplace.sh`** works with flat `./skills/<skill-name>` paths. It iterates `plugin.json` `skills[]` array and checks each resolves to a directory with SKILL.md \u2014 should work unchanged after T1's plugin.json update, but run and verify.\n\n5. **Regenerate `similarity-baseline.json`** by running the updated similarity validator.\n\n6. **Regenerate `routing-warnings-baseline.json`** by running `./scripts/validate-skills.sh` after T1 and T2 changes are in place.\n\n## Key context\n\n- **Sequential dependency**: This task and T2 both edit `_validate_skills.py`. They must NOT run in parallel \u2014 T2 lands first (frontmatter checks), then T3 adds layout guard. Rebase T3 onto T2 before starting.\n- `validate-similarity.py` is the highest-risk file: both `glob(\"*/*/SKILL.md\")` and `category = skill_md.parent.parent.name` are layout-coupled\n- Frontmatter safety checks (BOM, quoted desc, license, metadata) are owned by T2 \u2014 do NOT duplicate them here\n- The `routing-warnings-baseline.json` may change due to layout-induced warning count deltas; Copilot frontmatter checks are ERRORs and do not affect warning baselines\n\n## Acceptance\n- [ ] `validate-similarity.py` glob changed from `*/*/SKILL.md` to `*/SKILL.md`\n- [ ] Same-category boost removed from `validate-similarity.py`\n- [ ] `category` and `same_category` fields removed from similarity report (no longer meaningful after flatten)\n- [ ] `validate-similarity.py` finds all 131 skills on flat layout\n- [ ] Flat layout guard added to `_validate_skills.py`: ERROR if SKILL.md found >1 level deep under skills/\n- [ ] `validate-marketplace.sh` passes on flat layout\n- [ ] `similarity-baseline.json` regenerated for flat layout\n- [ ] `routing-warnings-baseline.json` regenerated for flat layout + T2 frontmatter checks\n- [ ] Full validation suite: `./scripts/validate-skills.sh && ./scripts/validate-marketplace.sh` green\n\n## Done summary\nUpdated similarity validator for flat layout: changed glob from */*/SKILL.md to */SKILL.md, removed same-category boost and category fields, reweighted composite score to 0.5/0.5. Added flat layout guard to _validate_skills.py that errors if SKILL.md is found more than 1 level deep. Regenerated similarity-baseline.json; routing-warnings-baseline.json unchanged (all zeros).\n## Evidence\n- Commits: b585e0a0f7abc306ba6d57e904ca1c1656b27393\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-21T00:04:30.748545Z",
        "depends_on": [
          "fn-56-copilot-structural-compatibility.1"
        ],
        "epic": "fn-56-copilot-structural-compatibility",
        "id": "fn-56-copilot-structural-compatibility.4",
        "priority": null,
        "spec_path": ".flow/tasks/fn-56-copilot-structural-compatibility.4.md",
        "status": "todo",
        "title": "32-skill routing strategy",
        "updated_at": "2026-02-21T01:09:03.781796Z"
      },
      "id": "fn-56-copilot-structural-compatibility.4",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-21T02:32:32.264376Z",
        "evidence": {
          "commits": [
            "ea0e981",
            "8bd368c",
            "5004b4f"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-21T02:57:21.505566Z"
      },
      "spec": "# fn-56-copilot-structural-compatibility.4 32-skill routing strategy\n\n## Description\n\nVerify how Copilot's 32-skill display limit interacts with `user-invocable: false` skills, then design and implement the appropriate routing strategy.\n\n**Size:** M\n**Files:** skills/*/SKILL.md (potentially many \u2014 invocability inventory may require explicit `user-invocable` on all 131), skills/dotnet-advisor/SKILL.md (primary for Phase 2B), CONTRIBUTING-SKILLS.md (constraint documentation)\n\n## Approach\n\n**Phase 1: Verify the 32-skill limit behavior (MUST complete before Phase 2)**\n\n1. **Inventory invocability across all 131 skills.** Generate a report counting `user-invocable: true` (explicit or default-omitted) vs `user-invocable: false` (explicit). If any skills omit the field and should be non-invocable, explicitly set `user-invocable: false` before measuring Copilot behavior. The expected split is 11 true / 120 false.\n\n2. **Determine if `user-invocable: false` skills count against the 32-skill limit.** With 120 of 131 skills marked `user-invocable: false`, this completely changes the strategy:\n   - **If excluded**: Only 11 user-invocable skills compete for the 32-slot window -> limit is a non-issue. Move to Phase 2A.\n   - **If included**: All 131 compete for 32 slots -> advisor meta-router needed. Move to Phase 2B.\n\n3. **Also verify the ordering** of visible skills (alphabetical? filesystem? manifest order?). Do not assume alphabetical.\n\n4. **Test method**: Install the flattened plugin in Copilot CLI and inspect the system prompt (or skill list output) for:\n   - Total skills shown vs total installed\n   - Whether non-user-invocable skills appear in the system prompt\n   - The exact ordering of visible skills\n\n**Phase 2A: Limit is a non-issue (only user-invocable skills count)**\n\n1. Verify all 11 user-invocable skills are discoverable by Copilot\n2. Verify the model can still activate non-user-invocable skills when contextually relevant\n3. Document the interaction in CONTRIBUTING-SKILLS.md\n\n**Phase 2B: Limit applies to all skills (fallback strategy)**\n\n1. **Ensure `dotnet-advisor` is within the visible window.** Verify its position in the ordering.\n2. **Verify advisor meta-routing works in Copilot**: Test that a prompt -> activates advisor (visible) -> advisor body references a skill outside the visible set -> Copilot loads that skill on demand. If this chain does NOT work, escalate and design an alternative.\n3. **Optimize advisor description** for Copilot activation (strong trigger language per Copilot issue #978).\n4. **Update advisor compressed catalog** organized by domain (not alphabetically).\n5. **Document the constraint** including which skills are visible and which require advisor routing.\n\n**Fallback if advisor meta-routing doesn't work in Copilot:**\n- Strategic renames to pull domain-specific \"router\" skills into visible window\n- Or: create lightweight alias skills within visible set that embed condensed domain instructions\n- Or: reduce non-essential skills' `user-invocable` to further shrink the competing set\n\n## Key context\n\n- 11 user-invocable skills: dotnet-advisor, dotnet-slopwatch, dotnet-scaffold-project, dotnet-add-analyzers, dotnet-modernize, dotnet-add-ci, dotnet-add-testing, dotnet-data-access-strategy, dotnet-version-upgrade, dotnet-windbg-debugging, dotnet-ui-chooser\n- dotnet-skills-evals tested compressed-index discovery at 56.5% TPR\n- The advisor at `skills/dotnet-advisor/SKILL.md` (after flatten) has 360 lines with 221 `[skill:]` cross-references\n- Copilot v0.0.412 added support for `user-invocable: false` and `disable-model-invocation`\n\n## Acceptance\n- [ ] Invocability inventory generated: exact count of true/false/omitted across all 131 skills\n- [ ] `user-invocable` is explicitly present (true or false) on all 131 skills, OR the default behavior is verified with Copilot and explicitly documented as intentional\n- [ ] 32-skill limit behavior with `user-invocable: false` verified and documented (measurement data captured)\n- [ ] Skill ordering method verified (alphabetical, filesystem, or other)\n- [ ] Appropriate routing strategy implemented based on verified behavior (Phase 2A or 2B)\n- [ ] If Phase 2B: advisor meta-routing verified to work in Copilot (or fallback implemented)\n- [ ] If Phase 2B: advisor description optimized for Copilot activation\n- [ ] If Phase 2B: advisor compressed catalog updated with all skills organized by domain\n- [ ] 32-skill constraint (or non-issue finding) documented in CONTRIBUTING-SKILLS.md\n- [ ] All `[skill:]` cross-references in advisor resolve correctly\n\n## Done summary\nAdded explicit user-invocable: true to 10 skills that relied on defaults (bringing all 131 skills to explicit invocability: 11 true, 120 false). Documented the Copilot CLI 32-skill display limit routing strategy in CONTRIBUTING-SKILLS.md, including dual-ordering strategy (manifest + alphabetical), behavior scenarios, compatibility rules, and verification procedure.\n## Evidence\n- Commits: ea0e981, 8bd368c, 5004b4f\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-21T00:04:30.868605Z",
        "depends_on": [
          "fn-56-copilot-structural-compatibility.1",
          "fn-56-copilot-structural-compatibility.4"
        ],
        "epic": "fn-56-copilot-structural-compatibility",
        "id": "fn-56-copilot-structural-compatibility.5",
        "priority": null,
        "spec_path": ".flow/tasks/fn-56-copilot-structural-compatibility.5.md",
        "status": "todo",
        "title": "Update all documentation for flat layout",
        "updated_at": "2026-02-21T00:52:39.371931Z"
      },
      "id": "fn-56-copilot-structural-compatibility.5",
      "runtime": {
        "assignee": "claire@novotny.org",
        "claim_note": "",
        "claimed_at": "2026-02-21T03:02:36.277398Z",
        "evidence": {
          "commits": [
            "39e0c4d93ca846abc1968bb389d7a8633513f6d1"
          ],
          "prs": [],
          "tests": [
            "./scripts/validate-skills.sh",
            "./scripts/validate-marketplace.sh"
          ]
        },
        "status": "done",
        "updated_at": "2026-02-21T03:41:51.172545Z"
      },
      "spec": "# fn-56-copilot-structural-compatibility.5 Update all documentation for flat layout\n\n## Description\n\nUpdate all documentation files that reference the nested `skills/<category>/<skill-name>/` directory layout to reflect the new flat `skills/<skill-name>/` structure. Update canonical skill count to 131 everywhere. Also update behavioral guidance that conflicts with Copilot compatibility (description quoting, similarity scoring).\n\n**Size:** M\n**Files:** AGENTS.md, CONTRIBUTING.md, CONTRIBUTING-SKILLS.md, README.md, docs/agent-routing-tests.md, .agents/openai.yaml, CHANGELOG.md\n\n## Approach\n\n1. **AGENTS.md** (and CLAUDE.md which @includes it): Update file structure diagram from `skills/<category>/<skill-name>/SKILL.md` to `skills/<skill-name>/SKILL.md`. Remove category count references. Update skill count to 131.\n2. **CONTRIBUTING.md**: Update cross-provider verification section (L238-258). Update any path references. Add Copilot-specific notes if applicable.\n3. **CONTRIBUTING-SKILLS.md**: Update skill authoring guide \u2014 directory creation instructions change from `skills/<category>/<name>/` to `skills/<name>/`. Update checklist items. Verify/preserve the 32-skill constraint docs already added by T4 at lines 108-147 (section \"### Copilot CLI 32-Skill Display Limit\") and the explicit `user-invocable` requirement at line 96; update any nested-path references within those sections if present. **Remove/replace \"quote descriptions for YAML safety\" guidance** (line 410) \u2014 Copilot requires unquoted descriptions. Update similarity scoring documentation to reflect removal of same-category boost (line 221 still references same-category boost and +0.15).\n4. **README.md**: Update installation section to include Copilot. Update architecture diagram if it shows nested layout. Update skill count to 131.\n5. **docs/agent-routing-tests.md**: Update Copilot source setup description (L22-32). Update evidence tier documentation (L93, L111) for current Copilot evidence patterns.\n6. **`.agents/openai.yaml`**: Verify both `default_prompt` and `short_description` were updated in T1 (flat paths + skill count 131).\n7. **CHANGELOG.md**: Add entries under `[Unreleased]` -> `### Added` for Copilot compatibility, flat layout, frontmatter migration.\n\n## Key context\n\n- AGENTS.md says `skills/<category>/<skill-name>/SKILL.md   # 130 skills across 22 categories` \u2014 update to `skills/<skill-name>/SKILL.md   # 131 skills`\n- CONTRIBUTING-SKILLS.md has detailed directory creation instructions that assume category subdirectories\n- docs/agent-routing-tests.md L93: \"Copilot historically had weaker skill-load evidence for nested `dotnet-*` skills\" \u2014 this is now resolved\n- CHANGELOG.md uses Keep a Changelog format\n- Skill count must be 131 everywhere (was inconsistently 130 in some places)\n\n## Acceptance\n- [ ] No documentation file references `skills/<category>/<skill-name>/` pattern (verified by multiple greps):\n  - `grep -rn 'skills/[a-z-]*/[a-z-]*/' *.md docs/ CONTRIBUTING* README* AGENTS* CLAUDE*` returns zero matches\n  - `grep -rn 'skills/.*/.*/SKILL.md' *.md docs/` returns zero matches\n- [ ] AGENTS.md file structure diagram shows flat layout with count 131\n- [ ] CONTRIBUTING-SKILLS.md skill creation instructions use flat layout\n- [ ] CONTRIBUTING-SKILLS.md includes 32-skill constraint documentation (already added by T4 at lines 108-147; verify preserved and no stale nested-path refs within it)\n- [ ] README.md mentions Copilot compatibility and skill count is 131\n- [ ] docs/agent-routing-tests.md updated for current Copilot evidence patterns\n- [ ] CHANGELOG.md has unreleased entries for Copilot compatibility changes\n- [ ] `.agents/openai.yaml` `default_prompt` and `short_description` both reflect 131 + flat layout\n- [ ] Canonical skill count (131) consistent across all docs\n- [ ] CONTRIBUTING-SKILLS.md no longer advises quoting descriptions (replaced with unquoted guidance for Copilot compat)\n- [ ] Similarity scoring documentation updated (no same-category boost)\n- [ ] CONTRIBUTING-SKILLS.md similarity formula matches the code (no same-category boost, no category/same_category fields) and troubleshooting no longer recommends quoting descriptions\n\n<!-- Updated by plan-sync: fn-56-copilot-structural-compatibility.4 already added 32-skill constraint docs to CONTRIBUTING-SKILLS.md (lines 108-147) and explicit user-invocable requirement (line 96); approach step 3 and acceptance criterion updated to verify/preserve rather than create -->\n\n## Done summary\nUpdated all documentation files for flat skill layout and Copilot compatibility. Changed AGENTS.md, CONTRIBUTING.md, CONTRIBUTING-SKILLS.md, README.md, CHANGELOG.md, docs/agent-routing-tests.md, docs/skill-routing-style-guide.md, docs/skill-routing-ownership-manifest.md, docs/skill-content-migration-map.md, and skills/dotnet-version-detection/SKILL.md to use flat paths, canonical count 131, unquoted description guidance, license: MIT as required field, user-invocable as repo-required, and consistent budget thresholds. Added Copilot/Codex installation instructions to README and CHANGELOG unreleased entries.\n## Evidence\n- Commits: 39e0c4d93ca846abc1968bb389d7a8633513f6d1\n- Tests: ./scripts/validate-skills.sh, ./scripts/validate-marketplace.sh\n- PRs:"
    }
  ]
}
