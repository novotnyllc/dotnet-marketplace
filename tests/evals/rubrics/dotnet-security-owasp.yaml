skill_name: dotnet-security-owasp

test_prompts:
  - "Harden an ASP.NET Core Minimal API against the OWASP Top 10. Show me how to add global authorization with fallback policy, rate limiting, security headers (CSP, X-Frame-Options, HSTS), anti-forgery protection, and CORS restrictions for a known frontend origin."
  - "Review this .NET code for security vulnerabilities: it uses FromSqlRaw with string concatenation, stores connection strings in appsettings.json, returns detailed exception info to clients, and accepts user-provided URLs for HttpClient calls without validation."

criteria:
  - name: injection_prevention
    weight: 0.25
    description: "Uses parameterized queries via EF Core LINQ or FromSqlInterpolated, never FromSqlRaw with string concatenation. Applies HtmlEncoder.Default.Encode for any user input rendered as HTML. Validates command inputs against allowlists. Understands the difference between FromSqlRaw and FromSqlInterpolated parameterization."
  - name: access_control
    weight: 0.25
    description: "Sets fallback authorization policy requiring authenticated users globally via SetFallbackPolicy. Implements resource-based authorization (AuthorizationHandler) to prevent IDOR. Restricts CORS to specific origins, never uses SetIsOriginAllowed(_ => true) with AllowCredentials. Justifies each [AllowAnonymous] endpoint."
  - name: security_configuration
    weight: 0.20
    description: "Adds security headers: X-Content-Type-Options nosniff, X-Frame-Options DENY, Content-Security-Policy, Referrer-Policy, and HSTS. Removes server identity headers via AddServerHeader=false. Gates UseDeveloperExceptionPage behind IsDevelopment. Constrains request body size via Kestrel limits."
  - name: rate_limiting_and_antiforgery
    weight: 0.15
    description: "Configures built-in rate limiting middleware (.NET 7+) with AddRateLimiter and RequireRateLimiting per endpoint. Adds anti-forgery for form-bound endpoints. Sets rejection status code to 429. Places UseRateLimiter after UseRouting."
  - name: dependency_and_data_integrity
    weight: 0.15
    description: "Enables NuGet audit with NuGetAuditMode=all for transitive vulnerability scanning. Uses package source mapping in nuget.config to prevent dependency confusion. Never uses BinaryFormatter (removed in .NET 9+). Uses System.Text.Json or MessagePack for serialization. Does not store secrets in appsettings.json."
