skill_name: dotnet-efcore-patterns

test_prompts:
  - "Set up EF Core for an ASP.NET Core API with a background order processing service. The API handles web requests and the background service processes orders in batches. Show the DbContext registration, proper lifetime management, and read-only query optimization."
  - "My EF Core query loading Orders with Items and Payments is slow due to Cartesian explosion. How do I fix this? Also show me how to add automatic audit timestamps via an interceptor."

criteria:
  - name: dbcontext_lifetime
    weight: 0.25
    description: "Registers DbContext as scoped via AddDbContext for web requests. Uses IDbContextFactory<T> via AddDbContextFactory for background services and Blazor Server. Never injects DbContext into singleton services. Understands AddDbContextPool pooling constraints."
  - name: query_optimization
    weight: 0.25
    description: "Applies AsNoTracking for read-only queries to reduce memory and CPU overhead. Uses AsSplitQuery when including two or more collection navigations to avoid Cartesian explosion. Knows when to use AsNoTrackingWithIdentityResolution for deduplication."
  - name: interceptor_patterns
    weight: 0.20
    description: "Implements SaveChangesInterceptor for audit timestamps or soft delete. Registers interceptors via DI with AddInterceptors on DbContext options. Combines soft delete interceptor with HasQueryFilter for automatic filtering and IgnoreQueryFilters for admin bypass."
  - name: migration_practices
    weight: 0.15
    description: "Uses migration bundles or idempotent scripts for production deployment. Never calls Database.Migrate() at application startup. Generates migrations with --project and --startup-project flags. Reviews generated Up/Down methods. Uses HasData for reference data seeding."
  - name: cancellation_and_resiliency
    weight: 0.15
    description: "Propagates CancellationToken to all async EF Core methods (ToListAsync, SaveChangesAsync, FindAsync). Configures EnableRetryOnFailure for connection resiliency. Uses CreateExecutionStrategy with explicit transactions for multi-SaveChanges atomic operations."
