skill_name: dotnet-resilience

test_prompts:
  - "Add resilience to an HttpClient that calls an external catalog API. Use the standard resilience pipeline with custom retry counts, circuit breaker thresholds, and timeouts. The configuration should be tunable via appsettings.json."
  - "I need to add retry logic to my EF Core repository for handling transient database failures, and a separate resilience pipeline for an external payment gateway HTTP client. Show both using Polly v8 and Microsoft.Extensions patterns."

criteria:
  - name: standard_pipeline
    weight: 0.30
    description: "Uses AddStandardResilienceHandler for HTTP clients with correct pipeline order: rate limiter -> total timeout -> retry -> circuit breaker -> attempt timeout. Customizes options (Retry.MaxRetryAttempts, CircuitBreaker.FailureRatio, AttemptTimeout.Timeout) rather than building from scratch. Does not add AddStandardResilienceHandler twice."
  - name: polly_v8_apis
    weight: 0.25
    description: "Uses Polly v8 ResiliencePipeline and strategy options (RetryStrategyOptions, CircuitBreakerStrategyOptions, TimeoutStrategyOptions) via AddResiliencePipeline for non-HTTP scenarios. Uses PredicateBuilder for ShouldHandle configuration. Does not mix Polly v7 IAsyncPolicy with v8 APIs."
  - name: retry_best_practices
    weight: 0.20
    description: "Configures exponential backoff with UseJitter=true to prevent thundering herd. Only retries idempotent operations. Sets ShouldHandle to target specific exceptions or HTTP status codes (408, 429, 5xx). Ensures attempt timeout is shorter than total timeout."
  - name: di_and_configuration
    weight: 0.15
    description: "Registers pipelines via DI with AddResiliencePipeline or AddStandardResilienceHandler. Binds configuration from appsettings.json via Configuration.GetSection().Bind(options). Injects ResiliencePipeline via [FromKeyedServices] or IHttpClientFactory. Uses Microsoft.Extensions.Http.Resilience, not the superseded Microsoft.Extensions.Http.Polly."
  - name: telemetry_awareness
    weight: 0.10
    description: "Acknowledges that resilience telemetry (polly.strategy.attempt.duration, pipeline.duration, attempt.count) is emitted automatically via DI-based registration. Mentions structured logging of retry attempts via OnRetry callback. References OpenTelemetry integration for production monitoring."
